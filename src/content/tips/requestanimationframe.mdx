---
title: "requestAnimationFrameã§æ»‘ã‚‰ã‹ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³"
description: "setTimeout/setIntervalã§ã¯ãªãrAFã‚’ä½¿ã£ã¦60fpsã‚’å®Ÿç¾ã™ã‚‹æ–¹æ³•"
tags: [javascript, animation, performance, requestanimationframe]
category: animation
level: intermediate
date: 2025-11-11
---

import LiveDemo from '../../components/LiveDemo.astro';

## requestAnimationFrame ã¨ã¯

`requestAnimationFrame` (rAF) ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã«æœ€é©ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®APIã§ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®å†æç”»ã‚µã‚¤ã‚¯ãƒ«ã«åŒæœŸã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€`setTimeout` ã‚„ `setInterval` ã‚ˆã‚Šã‚‚æ»‘ã‚‰ã‹ã§åŠ¹ç‡çš„ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚

### ãªãœ requestAnimationFrame ã‚’ä½¿ã†ã¹ãã‹

<LiveDemo
  title="setTimeout vs requestAnimationFrame"
  height="600px"
  html={`
<div class="raf-comparison">
  <div class="comparison-section">
    <h3>âŒ setTimeout (16ms)</h3>
    <div class="animation-container">
      <div class="ball ball-settimeout" id="ballTimeout"></div>
    </div>
    <div class="metrics">
      <div class="metric">
        <span>FPS:</span>
        <span id="fpsTimeout" class="fps-value">60</span>
      </div>
      <div class="metric">
        <span>ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‰ãƒ­ãƒƒãƒ—:</span>
        <span id="dropsTimeout" class="drops-value">0</span>
      </div>
    </div>
    <p class="description">ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒãšã‚Œã¦ã‚«ã‚¯ã¤ãå¯èƒ½æ€§ã‚ã‚Š</p>
  </div>

  <div class="comparison-section">
    <h3>âœ… requestAnimationFrame</h3>
    <div class="animation-container">
      <div class="ball ball-raf" id="ballRaf"></div>
    </div>
    <div class="metrics">
      <div class="metric">
        <span>FPS:</span>
        <span id="fpsRaf" class="fps-value">60</span>
      </div>
      <div class="metric">
        <span>ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‰ãƒ­ãƒƒãƒ—:</span>
        <span id="dropsRaf" class="drops-value">0</span>
      </div>
    </div>
    <p class="description">ãƒ–ãƒ©ã‚¦ã‚¶ã®å†æç”»ã«åŒæœŸã—ã¦æ»‘ã‚‰ã‹</p>
  </div>

  <div class="controls">
    <button id="startBtn" class="btn btn-start">é–‹å§‹</button>
    <button id="stopBtn" class="btn btn-stop">åœæ­¢</button>
    <button id="resetBtn" class="btn btn-reset">ãƒªã‚»ãƒƒãƒˆ</button>
  </div>
</div>
  `}
  css={`
.raf-comparison {
  max-width: 700px;
  margin: 0 auto;
  padding: 1.5rem;
}

.comparison-section {
  background: #1f2a37;
  border-radius: 8px;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
}

.comparison-section h3 {
  font-size: 1rem;
  color: #e5edf4;
  margin: 0 0 1rem 0;
}

.animation-container {
  position: relative;
  height: 100px;
  background: #0c1218;
  border-radius: 8px;
  margin-bottom: 1rem;
  overflow: hidden;
}

.ball {
  position: absolute;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  top: 25px;
  left: 0;
}

.ball-settimeout {
  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
}

.ball-raf {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
}

.metrics {
  background: #0c1218;
  border-radius: 6px;
  padding: 1rem;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  margin-bottom: 0.75rem;
}

.metric {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.metric span:first-child {
  font-size: 0.75rem;
  color: #9ca3af;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.fps-value,
.drops-value {
  font-size: 1.5rem;
  font-weight: 700;
  color: #10b981;
}

.drops-value.has-drops {
  color: #ef4444;
}

.description {
  font-size: 0.875rem;
  color: #9ca3af;
  margin: 0;
}

.controls {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0.75rem;
}

.btn {
  padding: 0.75rem 1rem;
  border: none;
  border-radius: 6px;
  font-weight: 600;
  font-size: 0.875rem;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-start {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: white;
}

.btn-stop {
  background: #374151;
  color: #e5edf4;
}

.btn-reset {
  background: #374151;
  color: #e5edf4;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.btn:active {
  transform: translateY(0);
}
  `}
  js={`
let animatingTimeout = false;
let animatingRaf = false;
let timeoutId = null;
let rafId = null;

const ballTimeout = document.getElementById('ballTimeout');
const ballRaf = document.getElementById('ballRaf');
const fpsTimeoutEl = document.getElementById('fpsTimeout');
const fpsRafEl = document.getElementById('fpsRaf');
const dropsTimeoutEl = document.getElementById('dropsTimeout');
const dropsRafEl = document.getElementById('dropsRaf');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const resetBtn = document.getElementById('resetBtn');

let lastTimeTimeout = performance.now();
let lastTimeRaf = performance.now();
let frameCountTimeout = 0;
let frameCountRaf = 0;
let dropsTimeout = 0;
let dropsRaf = 0;
let startPosTimeout = 0;
let startPosRaf = 0;

// setTimeoutç‰ˆ
function animateWithTimeout() {
  if (!animatingTimeout) return;

  const now = performance.now();
  const deltaTime = now - lastTimeTimeout;

  // FPSè¨ˆç®—
  frameCountTimeout++;
  if (deltaTime > 16.67 * 2) {
    dropsTimeout++;
    dropsTimeoutEl.textContent = dropsTimeout;
    dropsTimeoutEl.classList.add('has-drops');
  }

  const fps = Math.round(1000 / deltaTime);
  fpsTimeoutEl.textContent = fps;

  // ä½ç½®æ›´æ–°
  startPosTimeout += 2;
  if (startPosTimeout > 600) startPosTimeout = 0;
  ballTimeout.style.transform = 'translateX(' + startPosTimeout + 'px)';

  lastTimeTimeout = now;
  timeoutId = setTimeout(animateWithTimeout, 16);
}

// requestAnimationFrameç‰ˆ
function animateWithRaf() {
  if (!animatingRaf) return;

  const now = performance.now();
  const deltaTime = now - lastTimeRaf;

  // FPSè¨ˆç®—
  frameCountRaf++;
  if (deltaTime > 16.67 * 2) {
    dropsRaf++;
    dropsRafEl.textContent = dropsRaf;
    dropsRafEl.classList.add('has-drops');
  }

  const fps = Math.round(1000 / deltaTime);
  fpsRafEl.textContent = fps;

  // ä½ç½®æ›´æ–°
  startPosRaf += 2;
  if (startPosRaf > 600) startPosRaf = 0;
  ballRaf.style.transform = 'translateX(' + startPosRaf + 'px)';

  lastTimeRaf = now;
  rafId = requestAnimationFrame(animateWithRaf);
}

startBtn.addEventListener('click', () => {
  animatingTimeout = true;
  animatingRaf = true;
  animateWithTimeout();
  animateWithRaf();
});

stopBtn.addEventListener('click', () => {
  animatingTimeout = false;
  animatingRaf = false;
  if (timeoutId) clearTimeout(timeoutId);
  if (rafId) cancelAnimationFrame(rafId);
});

resetBtn.addEventListener('click', () => {
  animatingTimeout = false;
  animatingRaf = false;
  if (timeoutId) clearTimeout(timeoutId);
  if (rafId) cancelAnimationFrame(rafId);

  startPosTimeout = 0;
  startPosRaf = 0;
  dropsTimeout = 0;
  dropsRaf = 0;

  ballTimeout.style.transform = 'translateX(0)';
  ballRaf.style.transform = 'translateX(0)';
  fpsTimeoutEl.textContent = '60';
  fpsRafEl.textContent = '60';
  dropsTimeoutEl.textContent = '0';
  dropsRafEl.textContent = '0';
  dropsTimeoutEl.classList.remove('has-drops');
  dropsRafEl.classList.remove('has-drops');
});

// åˆæœŸè¡¨ç¤ºæ™‚ã«è‡ªå‹•é–‹å§‹
setTimeout(() => startBtn.click(), 500);
  `}
/>

## åŸºæœ¬çš„ãªä½¿ã„æ–¹

### ã‚·ãƒ³ãƒ—ãƒ«ãªä¾‹

```javascript
function animate() {
  // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†
  element.style.transform = `translateX(${x}px)`;

  // æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’è¦æ±‚
  requestAnimationFrame(animate);
}

// ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
requestAnimationFrame(animate);
```

### ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®åœæ­¢

```javascript
let animationId;

function animate() {
  // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†
  updateAnimation();

  // æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’è¦æ±‚
  animationId = requestAnimationFrame(animate);
}

// é–‹å§‹
animationId = requestAnimationFrame(animate);

// åœæ­¢
cancelAnimationFrame(animationId);
```

## deltaTime ã‚’ä½¿ã£ãŸæ»‘ã‚‰ã‹ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆãŒå¤‰å‹•ã—ã¦ã‚‚ä¸€å®šé€Ÿåº¦ã§å‹•ãã‚ˆã†ã«ã€`deltaTime` ã‚’ä½¿ã„ã¾ã™ï¼š

<LiveDemo
  title="deltaTime ã«ã‚ˆã‚‹é€Ÿåº¦åˆ¶å¾¡"
  height="550px"
  html={`
<div class="deltatime-demo">
  <div class="demo-section">
    <h3>âŒ deltaTime ãªã—</h3>
    <div class="track">
      <div class="runner runner-no-delta" id="runnerNoDelta">ğŸƒ</div>
    </div>
    <p class="info">ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆãŒå¤‰ã‚ã‚‹ã¨é€Ÿåº¦ã‚‚å¤‰ã‚ã‚‹</p>
  </div>

  <div class="demo-section">
    <h3>âœ… deltaTime ã‚ã‚Š</h3>
    <div class="track">
      <div class="runner runner-with-delta" id="runnerWithDelta">ğŸƒ</div>
    </div>
    <p class="info">å¸¸ã«ä¸€å®šé€Ÿåº¦ã§å‹•ã</p>
  </div>

  <div class="controls-panel">
    <div class="control-group">
      <label>FPSåˆ¶é™:</label>
      <select id="fpsLimit" class="select">
        <option value="60">60 FPS (åˆ¶é™ãªã—)</option>
        <option value="30">30 FPS</option>
        <option value="15">15 FPS</option>
      </select>
    </div>
    <div class="stats-panel">
      <div class="stat">
        <span>ç¾åœ¨ã® FPS:</span>
        <span id="currentFps">60</span>
      </div>
    </div>
  </div>
</div>
  `}
  css={`
.deltatime-demo {
  max-width: 600px;
  margin: 0 auto;
  padding: 1.5rem;
}

.demo-section {
  background: #1f2a37;
  border-radius: 8px;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
}

.demo-section h3 {
  font-size: 1rem;
  color: #e5edf4;
  margin: 0 0 1rem 0;
}

.track {
  position: relative;
  height: 80px;
  background: #0c1218;
  border-radius: 8px;
  margin-bottom: 0.75rem;
  overflow: hidden;
}

.runner {
  position: absolute;
  font-size: 3rem;
  top: 15px;
  left: 0;
  user-select: none;
}

.info {
  font-size: 0.875rem;
  color: #9ca3af;
  margin: 0;
}

.controls-panel {
  background: #1f2a37;
  border-radius: 8px;
  padding: 1.5rem;
}

.control-group {
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 1rem;
}

.control-group label {
  font-size: 0.875rem;
  color: #e5edf4;
  font-weight: 600;
}

.select {
  flex: 1;
  padding: 0.5rem;
  background: #0c1218;
  border: 1px solid #374151;
  border-radius: 6px;
  color: #e5edf4;
  font-size: 0.875rem;
}

.stats-panel {
  background: #0c1218;
  border-radius: 6px;
  padding: 1rem;
}

.stat {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.875rem;
}

.stat span:first-child {
  color: #9ca3af;
}

.stat span:last-child {
  font-size: 1.125rem;
  font-weight: 700;
  color: #10b981;
}
  `}
  js={`
const runnerNoDelta = document.getElementById('runnerNoDelta');
const runnerWithDelta = document.getElementById('runnerWithDelta');
const fpsLimitSelect = document.getElementById('fpsLimit');
const currentFpsEl = document.getElementById('currentFps');

let lastTime = performance.now();
let posNoDelta = 0;
let posWithDelta = 0;
let fpsLimit = 60;
let frameInterval = 1000 / fpsLimit;
let lastFrameTime = 0;

const SPEED = 100; // ãƒ”ã‚¯ã‚»ãƒ«/ç§’

fpsLimitSelect.addEventListener('change', (e) => {
  fpsLimit = parseInt(e.target.value);
  frameInterval = 1000 / fpsLimit;
});

function animate(currentTime) {
  requestAnimationFrame(animate);

  // FPSåˆ¶é™
  const timeSinceLastFrame = currentTime - lastFrameTime;
  if (timeSinceLastFrame < frameInterval) return;
  lastFrameTime = currentTime - (timeSinceLastFrame % frameInterval);

  const deltaTime = (currentTime - lastTime) / 1000; // ç§’ã«å¤‰æ›
  lastTime = currentTime;

  // FPSè¡¨ç¤º
  const fps = Math.round(1 / deltaTime);
  currentFpsEl.textContent = fps;

  // deltaTime ãªã—: æ¯ãƒ•ãƒ¬ãƒ¼ãƒ 2pxç§»å‹•ï¼ˆFPSã«ä¾å­˜ï¼‰
  posNoDelta += 2;
  if (posNoDelta > 500) posNoDelta = 0;
  runnerNoDelta.style.transform = 'translateX(' + posNoDelta + 'px)';

  // deltaTime ã‚ã‚Š: å¸¸ã«100px/ç§’ã§ç§»å‹•ï¼ˆFPSã«ä¾å­˜ã—ãªã„ï¼‰
  posWithDelta += SPEED * deltaTime;
  if (posWithDelta > 500) posWithDelta = 0;
  runnerWithDelta.style.transform = 'translateX(' + posWithDelta + 'px)';
}

requestAnimationFrame(animate);
  `}
/>

### deltaTime ã‚’ä½¿ã£ãŸã‚³ãƒ¼ãƒ‰

```javascript
let lastTime = performance.now();
let position = 0;
const SPEED = 100; // ãƒ”ã‚¯ã‚»ãƒ«/ç§’

function animate(currentTime) {
  // å‰ãƒ•ãƒ¬ãƒ¼ãƒ ã‹ã‚‰ã®çµŒéæ™‚é–“ï¼ˆç§’ï¼‰
  const deltaTime = (currentTime - lastTime) / 1000;
  lastTime = currentTime;

  // é€Ÿåº¦ Ã— æ™‚é–“ = ç§»å‹•è·é›¢
  position += SPEED * deltaTime;

  element.style.transform = `translateX(${position}px)`;

  requestAnimationFrame(animate);
}

requestAnimationFrame(animate);
```

## å®Ÿè·µä¾‹: ã‚¹ãƒ ãƒ¼ã‚ºãªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

<LiveDemo
  title="ã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒ ãƒ¼ã‚¹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«"
  height="550px"
  html={`
<div class="smooth-scroll-demo">
  <div class="demo-header">
    <h3>ã‚¹ãƒ ãƒ¼ã‚¹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®å®Ÿè£…</h3>
    <div class="nav-buttons">
      <button class="nav-btn" data-target="0">ã‚»ã‚¯ã‚·ãƒ§ãƒ³ 1</button>
      <button class="nav-btn" data-target="300">ã‚»ã‚¯ã‚·ãƒ§ãƒ³ 2</button>
      <button class="nav-btn" data-target="600">ã‚»ã‚¯ã‚·ãƒ§ãƒ³ 3</button>
    </div>
  </div>

  <div class="scroll-container" id="scrollContainer">
    <div class="section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
      <h4>ã‚»ã‚¯ã‚·ãƒ§ãƒ³ 1</h4>
      <p>ã‚¹ãƒ ãƒ¼ã‚ºã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¾ã™</p>
    </div>

    <div class="section" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
      <h4>ã‚»ã‚¯ã‚·ãƒ§ãƒ³ 2</h4>
      <p>ã‚¤ãƒ¼ã‚¸ãƒ³ã‚°é–¢æ•°ã§è‡ªç„¶ãªå‹•ã</p>
    </div>

    <div class="section" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
      <h4>ã‚»ã‚¯ã‚·ãƒ§ãƒ³ 3</h4>
      <p>requestAnimationFrame ã‚’ä½¿ç”¨</p>
    </div>
  </div>
</div>
  `}
  css={`
.smooth-scroll-demo {
  max-width: 600px;
  margin: 0 auto;
  padding: 1.5rem;
}

.demo-header {
  background: #1f2a37;
  border-radius: 8px;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
}

.demo-header h3 {
  font-size: 1rem;
  color: #e5edf4;
  margin: 0 0 1rem 0;
}

.nav-buttons {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0.5rem;
}

.nav-btn {
  padding: 0.5rem;
  background: #374151;
  border: 1px solid #4b5563;
  border-radius: 6px;
  color: #e5edf4;
  font-size: 0.75rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.nav-btn:hover {
  background: #4b5563;
  transform: translateY(-2px);
}

.scroll-container {
  height: 300px;
  overflow-y: scroll;
  border-radius: 8px;
  scroll-behavior: auto;
}

.section {
  height: 300px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: white;
  margin-bottom: 1rem;
  border-radius: 8px;
}

.section h4 {
  font-size: 1.5rem;
  margin: 0 0 0.5rem 0;
}

.section p {
  font-size: 1rem;
  margin: 0;
  opacity: 0.9;
}
  `}
  js={`
const scrollContainer = document.getElementById('scrollContainer');
const navButtons = document.querySelectorAll('.nav-btn');

function easeInOutCubic(t) {
  return t < 0.5
    ? 4 * t * t * t
    : 1 - Math.pow(-2 * t + 2, 3) / 2;
}

function smoothScrollTo(targetPosition, duration = 600) {
  const startPosition = scrollContainer.scrollTop;
  const distance = targetPosition - startPosition;
  const startTime = performance.now();

  function animation(currentTime) {
    const elapsed = currentTime - startTime;
    const progress = Math.min(elapsed / duration, 1);
    const easeProgress = easeInOutCubic(progress);

    scrollContainer.scrollTop = startPosition + (distance * easeProgress);

    if (progress < 1) {
      requestAnimationFrame(animation);
    }
  }

  requestAnimationFrame(animation);
}

navButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    const target = parseInt(btn.dataset.target);
    smoothScrollTo(target);
  });
});
  `}
/>

### ã‚¹ãƒ ãƒ¼ã‚¹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®ã‚³ãƒ¼ãƒ‰

```javascript
function easeInOutCubic(t) {
  return t < 0.5
    ? 4 * t * t * t
    : 1 - Math.pow(-2 * t + 2, 3) / 2;
}

function smoothScrollTo(targetPosition, duration = 600) {
  const startPosition = window.scrollY;
  const distance = targetPosition - startPosition;
  const startTime = performance.now();

  function animation(currentTime) {
    const elapsed = currentTime - startTime;
    const progress = Math.min(elapsed / duration, 1);

    // ã‚¤ãƒ¼ã‚¸ãƒ³ã‚°é–¢æ•°ã‚’é©ç”¨
    const easeProgress = easeInOutCubic(progress);

    window.scrollTo(0, startPosition + (distance * easeProgress));

    if (progress < 1) {
      requestAnimationFrame(animation);
    }
  }

  requestAnimationFrame(animation);
}

// ä½¿ç”¨ä¾‹
button.addEventListener('click', () => {
  smoothScrollTo(1000); // Yä½ç½®1000pxã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
});
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æœ€é©åŒ–

### 1. å‡¦ç†ã®åˆ†é›¢

é‡ã„å‡¦ç†ã¯åˆ¥ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã§å®Ÿè¡Œï¼š

```javascript
let needsUpdate = false;
let data = null;

function animate() {
  if (needsUpdate) {
    // è»½ã„å‡¦ç†: æç”»ã®ã¿
    render(data);
    needsUpdate = false;
  }

  requestAnimationFrame(animate);
}

// é‡ã„å‡¦ç†ã¯åˆ¥é€”å®Ÿè¡Œ
function updateData() {
  data = heavyCalculation();
  needsUpdate = true;
}

requestAnimationFrame(animate);
```

### 2. Throttlingï¼ˆå®Ÿè¡Œé »åº¦ã®åˆ¶é™ï¼‰

```javascript
let lastUpdate = 0;
const updateInterval = 100; // 100msã”ã¨ã«æ›´æ–°

function animate(currentTime) {
  if (currentTime - lastUpdate >= updateInterval) {
    update();
    lastUpdate = currentTime;
  }

  requestAnimationFrame(animate);
}

requestAnimationFrame(animate);
```

### 3. æ¡ä»¶ä»˜ãå®Ÿè¡Œ

```javascript
let isAnimating = false;

function animate() {
  if (!isAnimating) return;

  update();
  requestAnimationFrame(animate);
}

// é–‹å§‹
function start() {
  isAnimating = true;
  requestAnimationFrame(animate);
}

// åœæ­¢
function stop() {
  isAnimating = false;
}
```

## ã‚ˆãã‚ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

### 1. ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

```javascript
function animateCounter(element, target, duration = 1000) {
  const start = 0;
  const startTime = performance.now();

  function update(currentTime) {
    const elapsed = currentTime - startTime;
    const progress = Math.min(elapsed / duration, 1);

    const current = Math.floor(start + (target - start) * progress);
    element.textContent = current;

    if (progress < 1) {
      requestAnimationFrame(update);
    }
  }

  requestAnimationFrame(update);
}

// ä½¿ç”¨ä¾‹
animateCounter(document.getElementById('counter'), 1000);
```

### 2. ãƒ‘ãƒ©ãƒ©ãƒƒã‚¯ã‚¹åŠ¹æœ

```javascript
function parallax() {
  const scrollY = window.scrollY;

  document.querySelectorAll('.parallax').forEach(el => {
    const speed = el.dataset.speed || 0.5;
    const yPos = -(scrollY * speed);
    el.style.transform = `translate3d(0, ${yPos}px, 0)`;
  });

  requestAnimationFrame(parallax);
}

requestAnimationFrame(parallax);
```

### 3. ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—

```javascript
class Game {
  constructor() {
    this.lastTime = 0;
    this.isRunning = false;
  }

  start() {
    this.isRunning = true;
    requestAnimationFrame((time) => this.gameLoop(time));
  }

  stop() {
    this.isRunning = false;
  }

  gameLoop(currentTime) {
    if (!this.isRunning) return;

    const deltaTime = (currentTime - this.lastTime) / 1000;
    this.lastTime = currentTime;

    // ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã®æ›´æ–°
    this.update(deltaTime);

    // æç”»
    this.render();

    // æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ 
    requestAnimationFrame((time) => this.gameLoop(time));
  }

  update(deltaTime) {
    // ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’æ›´æ–°
  }

  render() {
    // ç”»é¢ã‚’æç”»
  }
}

const game = new Game();
game.start();
```

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] `setTimeout`/`setInterval` ã®ä»£ã‚ã‚Šã« `requestAnimationFrame` ã‚’ä½¿ç”¨
- [ ] `deltaTime` ã‚’ä½¿ã£ã¦ä¸€å®šé€Ÿåº¦ã‚’ç¶­æŒ
- [ ] `cancelAnimationFrame` ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©åˆ‡ã«åœæ­¢
- [ ] ä¸è¦ãªå†æç”»ã‚’é¿ã‘ã‚‹ï¼ˆæ¡ä»¶åˆ†å²ã§åˆ¶å¾¡ï¼‰
- [ ] é‡ã„å‡¦ç†ã¯åˆ†é›¢ã—ã¦å®Ÿè¡Œ
- [ ] ã‚¿ãƒ–ãŒéè¡¨ç¤ºã®æ™‚ã¯è‡ªå‹•çš„ã«åœæ­¢ã•ã‚Œã‚‹ï¼ˆrAF ã®ä»•æ§˜ï¼‰

### ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³

```javascript
// âŒ æ‚ªã„ä¾‹: setInterval
setInterval(() => {
  element.style.transform = `translateX(${x}px)`;
  x += 2;
}, 16);

// âœ… è‰¯ã„ä¾‹: requestAnimationFrame
function animate() {
  element.style.transform = `translateX(${x}px)`;
  x += 2;
  requestAnimationFrame(animate);
}
requestAnimationFrame(animate);
```

## ã‚¿ãƒ–ã®å¯è¦–æ€§ã¸ã®å¯¾å¿œ

`requestAnimationFrame` ã¯ã‚¿ãƒ–ãŒéè¡¨ç¤ºã®æ™‚ã«è‡ªå‹•çš„ã«åœæ­¢ã—ã¾ã™ãŒã€æ˜ç¤ºçš„ã«åˆ¶å¾¡ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼š

```javascript
let animationId;

document.addEventListener('visibilitychange', () => {
  if (document.hidden) {
    // ã‚¿ãƒ–ãŒéè¡¨ç¤ºã«ãªã£ãŸ
    cancelAnimationFrame(animationId);
  } else {
    // ã‚¿ãƒ–ãŒè¡¨ç¤ºã•ã‚ŒãŸ
    animationId = requestAnimationFrame(animate);
  }
});
```

## ã¾ã¨ã‚

1. **rAF ã‚’å„ªå…ˆ** - setTimeout/setInterval ã‚ˆã‚Šæ»‘ã‚‰ã‹ã§åŠ¹ç‡çš„
2. **deltaTime ã‚’ä½¿ã†** - ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆã«ä¾å­˜ã—ãªã„å‹•ãã‚’å®Ÿç¾
3. **é©åˆ‡ã«åœæ­¢** - cancelAnimationFrame ã§ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚’é˜²ã
4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é‡è¦–** - é‡ã„å‡¦ç†ã¯åˆ†é›¢ã—ã€æ¡ä»¶ä»˜ãã§å®Ÿè¡Œ
5. **60fps ã‚’ç›®æŒ‡ã™** - 1ãƒ•ãƒ¬ãƒ¼ãƒ  16.67ms ä»¥å†…ã«å‡¦ç†ã‚’å®Œäº†

## å‚è€ƒãƒªãƒ³ã‚¯

- [requestAnimationFrame - MDN](https://developer.mozilla.org/ja/docs/Web/API/window/requestAnimationFrame)
- [Rendering Performance - web.dev](https://web.dev/rendering-performance/)
- [Using requestAnimationFrame - CSS-Tricks](https://css-tricks.com/using-requestanimationframe/)

## Claude Codeã¸ã®æŒ‡ç¤º

ã“ã®Tipsã‚’Claude Codeã«å®Ÿè£…ã—ã¦ã‚‚ã‚‰ã†å ´åˆã€ä»¥ä¸‹ã®ç‚¹ã‚’æŒ‡ç¤ºã—ã¦ãã ã•ã„ï¼š

- 1. CSSã¾ãŸã¯JavaScriptã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…
- 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ã—ã¦transform/opacityã‚’ä½¿ç”¨
- 3. prefers-reduced-motionã«å¯¾å¿œ
- 4. ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã«å¯¾å¿œ
- 5. ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¨ãƒ‡ãƒ¢ã‚’æä¾›

### ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹

```
requestAnimationFrameã§æ»‘ã‚‰ã‹ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚

è¦ä»¶ï¼š
setTimeout/setIntervalã§ã¯ãªãrAFã‚’ä½¿ã£ã¦60fpsã‚’å®Ÿç¾ã™ã‚‹æ–¹æ³•

ä»¥ä¸‹ã®ç‚¹ã‚’å®ˆã£ã¦ãã ã•ã„ï¼š
1. CSSã¾ãŸã¯JavaScriptã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…
2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ã—ã¦transform/opacityã‚’ä½¿ç”¨
3. prefers-reduced-motionã«å¯¾å¿œ
4. ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã«å¯¾å¿œ
5. ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¨ãƒ‡ãƒ¢ã‚’æä¾›
```

