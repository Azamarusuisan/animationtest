---
title: Service Workeræˆ¦ç•¥3ç¨®
description: ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã‚’ç†è§£ã—ã¦ã€æœ€é©ãªã‚ªãƒ•ãƒ©ã‚¤ãƒ³ä½“é¨“ã‚’å®Ÿç¾ã™ã‚‹
tags: [service-worker, pwa, performance, caching, offline]
category: performance
level: advanced
date: 2025-11-11
---

import LiveDemo from '../../components/LiveDemo.astro';

## Service Worker ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã¨ã¯

Service Worker ã‚’ä½¿ã†ã¨ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’åˆ¶å¾¡ã§ãã¾ã™ã€‚é©åˆ‡ãªæˆ¦ç•¥ã‚’é¸ã¶ã“ã¨ã§ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ãƒ‡ãƒ¼ã‚¿ã®æ–°é®®ã•ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### ä¸»ãª3ã¤ã®æˆ¦ç•¥

<LiveDemo
  title="Service Worker ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã®æ¯”è¼ƒ"
  height="700px"
  html={`
<div class="sw-strategies-demo">
  <div class="strategy-selector">
    <h3>ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã‚’é¸æŠ</h3>
    <div class="strategy-buttons">
      <button class="strategy-btn active" data-strategy="network-first">
        <span class="strategy-icon">ğŸŒ</span>
        <span class="strategy-name">Network First</span>
      </button>
      <button class="strategy-btn" data-strategy="cache-first">
        <span class="strategy-icon">ğŸ’¾</span>
        <span class="strategy-name">Cache First</span>
      </button>
      <button class="strategy-btn" data-strategy="stale-while-revalidate">
        <span class="strategy-icon">âš¡</span>
        <span class="strategy-name">Stale While Revalidate</span>
      </button>
    </div>
  </div>

  <div class="strategy-info" id="strategyInfo">
    <div class="info-content" data-strategy="network-first">
      <h4>ğŸŒ Network First</h4>
      <p>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’å„ªå…ˆã€å¤±æ•—æ™‚ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—</p>
      <div class="use-case">
        <strong>æœ€é©ãªç”¨é€”:</strong> API ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€ãƒ‹ãƒ¥ãƒ¼ã‚¹è¨˜äº‹ãªã©å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
      </div>
    </div>
    <div class="info-content" data-strategy="cache-first" style="display:none;">
      <h4>ğŸ’¾ Cache First</h4>
      <p>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å„ªå…ˆã€ç„¡ã‘ã‚Œã°ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰å–å¾—</p>
      <div class="use-case">
        <strong>æœ€é©ãªç”¨é€”:</strong> CSSã€JavaScriptã€ç”»åƒãªã©ã®é™çš„ã‚¢ã‚»ãƒƒãƒˆ
      </div>
    </div>
    <div class="info-content" data-strategy="stale-while-revalidate" style="display:none;">
      <h4>âš¡ Stale While Revalidate</h4>
      <p>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å³åº§ã«è¿”ã—ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§æ›´æ–°</p>
      <div class="use-case">
        <strong>æœ€é©ãªç”¨é€”:</strong> ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã€å³åº§ã«è¡¨ç¤ºã—ãŸã„ãŒæœ€æ–°ç‰ˆã‚‚æ¬²ã—ã„ã‚‚ã®
      </div>
    </div>
  </div>

  <div class="control-panel">
    <div class="network-toggle">
      <label class="toggle-label">
        <input type="checkbox" id="networkDelay" checked>
        <span class="toggle-slider"></span>
        <span class="toggle-text">ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é…å»¶ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼ˆ1.5ç§’ï¼‰</span>
      </label>
    </div>
    <button class="action-btn" id="fetchBtn">
      <span>ğŸ“¥</span>
      <span>ãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Ÿè¡Œ</span>
    </button>
    <button class="action-btn secondary" id="clearCacheBtn">
      <span>ğŸ—‘ï¸</span>
      <span>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢</span>
    </button>
  </div>

  <div class="metrics-panel">
    <div class="metric-card">
      <div class="metric-label">ã‚­ãƒ£ãƒƒã‚·ãƒ¥çŠ¶æ…‹</div>
      <div class="metric-value" id="cacheStatus">ç©º</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">æœ€çµ‚èª­ã¿è¾¼ã¿æ™‚é–“</div>
      <div class="metric-value" id="loadTime">-</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹</div>
      <div class="metric-value" id="dataSource">-</div>
    </div>
  </div>

  <div class="timeline" id="timeline">
    <div class="timeline-header">ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</div>
    <div class="timeline-content" id="timelineContent">
      <div class="timeline-empty">ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„</div>
    </div>
  </div>

  <div class="response-viewer">
    <div class="response-header">ãƒ¬ã‚¹ãƒãƒ³ã‚¹å†…å®¹</div>
    <div class="response-content" id="responseContent">
      <div class="response-empty">ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãã ã•ã„</div>
    </div>
  </div>
</div>
  `}
  css={`
.sw-strategies-demo {
  max-width: 800px;
  margin: 0 auto;
  padding: 1.5rem;
}

.strategy-selector {
  background: #1f2a37;
  border-radius: 8px;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
}

.strategy-selector h3 {
  margin: 0 0 1rem 0;
  font-size: 1rem;
  color: #e5edf4;
}

.strategy-buttons {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 0.75rem;
}

.strategy-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  padding: 1rem;
  background: #0c1218;
  border: 2px solid #374151;
  border-radius: 8px;
  color: #9ca3af;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 0.875rem;
}

.strategy-btn:hover {
  border-color: #4b5563;
  transform: translateY(-2px);
}

.strategy-btn.active {
  border-color: #10b981;
  background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%);
  color: #10b981;
}

.strategy-icon {
  font-size: 2rem;
}

.strategy-name {
  font-weight: 600;
}

.strategy-info {
  background: #1f2a37;
  border-radius: 8px;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
  min-height: 120px;
}

.info-content h4 {
  margin: 0 0 0.5rem 0;
  font-size: 1.125rem;
  color: #e5edf4;
}

.info-content p {
  margin: 0 0 0.75rem 0;
  color: #9ca3af;
  font-size: 0.9375rem;
}

.use-case {
  background: #0c1218;
  border-left: 3px solid #10b981;
  padding: 0.75rem 1rem;
  border-radius: 4px;
  font-size: 0.875rem;
  color: #d1d5db;
}

.use-case strong {
  color: #10b981;
}

.control-panel {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.network-toggle {
  flex: 1;
  min-width: 200px;
}

.toggle-label {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  cursor: pointer;
  background: #1f2a37;
  padding: 1rem;
  border-radius: 8px;
  transition: background 0.2s;
}

.toggle-label:hover {
  background: #374151;
}

.toggle-label input {
  display: none;
}

.toggle-slider {
  position: relative;
  width: 44px;
  height: 24px;
  background: #374151;
  border-radius: 12px;
  transition: background 0.3s;
}

.toggle-slider::after {
  content: '';
  position: absolute;
  top: 2px;
  left: 2px;
  width: 20px;
  height: 20px;
  background: #e5edf4;
  border-radius: 50%;
  transition: transform 0.3s;
}

.toggle-label input:checked + .toggle-slider {
  background: #10b981;
}

.toggle-label input:checked + .toggle-slider::after {
  transform: translateX(20px);
}

.toggle-text {
  font-size: 0.875rem;
  color: #e5edf4;
}

.action-btn {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.875rem 1.5rem;
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  border: none;
  border-radius: 8px;
  color: white;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 0.9375rem;
}

.action-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
}

.action-btn:active {
  transform: translateY(0);
}

.action-btn.secondary {
  background: #374151;
}

.action-btn.secondary:hover {
  background: #4b5563;
  box-shadow: 0 4px 12px rgba(55, 65, 81, 0.4);
}

.metrics-panel {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.metric-card {
  background: #1f2a37;
  border-radius: 8px;
  padding: 1.25rem;
  text-align: center;
}

.metric-label {
  font-size: 0.75rem;
  color: #9ca3af;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 0.5rem;
}

.metric-value {
  font-size: 1.5rem;
  font-weight: 700;
  color: #10b981;
}

.timeline {
  background: #1f2a37;
  border-radius: 8px;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
}

.timeline-header {
  font-size: 0.9375rem;
  font-weight: 600;
  color: #e5edf4;
  margin-bottom: 1rem;
}

.timeline-content {
  background: #0c1218;
  border-radius: 6px;
  padding: 1rem;
  min-height: 100px;
}

.timeline-empty {
  text-align: center;
  color: #6b7280;
  font-size: 0.875rem;
  padding: 1rem;
}

.timeline-event {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem;
  margin-bottom: 0.5rem;
  background: #1f2a37;
  border-radius: 6px;
  font-size: 0.875rem;
  animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(-10px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.timeline-event .event-time {
  font-weight: 600;
  color: #10b981;
  min-width: 60px;
}

.timeline-event .event-desc {
  color: #d1d5db;
}

.response-viewer {
  background: #1f2a37;
  border-radius: 8px;
  padding: 1.5rem;
}

.response-header {
  font-size: 0.9375rem;
  font-weight: 600;
  color: #e5edf4;
  margin-bottom: 1rem;
}

.response-content {
  background: #0c1218;
  border-radius: 6px;
  padding: 1rem;
  font-family: 'Courier New', monospace;
  font-size: 0.875rem;
  color: #e5edf4;
  min-height: 80px;
}

.response-empty {
  text-align: center;
  color: #6b7280;
  padding: 1rem;
}

.response-data {
  color: #10b981;
}
  `}
  js={`
// ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
let cache = null;
let currentStrategy = 'network-first';
let requestCount = 0;

// DOMè¦ç´ 
const strategyBtns = document.querySelectorAll('.strategy-btn');
const strategyInfos = document.querySelectorAll('.info-content');
const networkDelayCheckbox = document.getElementById('networkDelay');
const fetchBtn = document.getElementById('fetchBtn');
const clearCacheBtn = document.getElementById('clearCacheBtn');
const cacheStatus = document.getElementById('cacheStatus');
const loadTime = document.getElementById('loadTime');
const dataSource = document.getElementById('dataSource');
const timelineContent = document.getElementById('timelineContent');
const responseContent = document.getElementById('responseContent');

// æˆ¦ç•¥åˆ‡ã‚Šæ›¿ãˆ
strategyBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    strategyBtns.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentStrategy = btn.dataset.strategy;

    strategyInfos.forEach(info => {
      info.style.display = info.dataset.strategy === currentStrategy ? 'block' : 'none';
    });
  });
});

// ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã«è¿½åŠ 
function addTimelineEvent(time, description) {
  if (timelineContent.querySelector('.timeline-empty')) {
    timelineContent.innerHTML = '';
  }

  const event = document.createElement('div');
  event.className = 'timeline-event';
  event.innerHTML = \`
    <span class="event-time">\${time}ms</span>
    <span class="event-desc">\${description}</span>
  \`;
  timelineContent.appendChild(event);
}

// ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰å–å¾—ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
async function fetchFromNetwork(delay) {
  const start = Date.now();
  addTimelineEvent(0, 'ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆé–‹å§‹...');

  await new Promise(resolve => setTimeout(resolve, delay));

  const elapsed = Date.now() - start;
  const data = {
    content: 'ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿',
    timestamp: new Date().toLocaleTimeString('ja-JP'),
    version: requestCount + 1
  };

  addTimelineEvent(elapsed, 'âœ… ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰å–å¾—å®Œäº†');
  return { data, elapsed };
}

// ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—
async function fetchFromCache() {
  const start = Date.now();
  addTimelineEvent(0, 'ğŸ’¾ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—...');

  await new Promise(resolve => setTimeout(resolve, 50));

  const elapsed = Date.now() - start;
  addTimelineEvent(elapsed, 'âœ… ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—å®Œäº†');
  return { data: cache, elapsed };
}

// Network First æˆ¦ç•¥
async function networkFirst(delay) {
  try {
    const result = await fetchFromNetwork(delay);
    cache = result.data;
    updateCacheStatus();
    return { ...result, source: 'Network' };
  } catch (error) {
    addTimelineEvent(delay, 'âš ï¸ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯');
    if (cache) {
      const result = await fetchFromCache();
      return { ...result, source: 'Cache (Fallback)' };
    }
    throw new Error('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—');
  }
}

// Cache First æˆ¦ç•¥
async function cacheFirst(delay) {
  if (cache) {
    const result = await fetchFromCache();
    return { ...result, source: 'Cache' };
  }

  addTimelineEvent(0, 'â„¹ï¸ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰å–å¾—');
  const result = await fetchFromNetwork(delay);
  cache = result.data;
  updateCacheStatus();
  return { ...result, source: 'Network (First time)' };
}

// Stale While Revalidate æˆ¦ç•¥
async function staleWhileRevalidate(delay) {
  if (cache) {
    const cacheResult = await fetchFromCache();

    // ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§æ›´æ–°
    addTimelineEvent(cacheResult.elapsed + 50, 'ğŸ”„ ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§æ›´æ–°ä¸­...');
    fetchFromNetwork(delay).then(result => {
      cache = result.data;
      updateCacheStatus();
      const totalTime = cacheResult.elapsed + result.elapsed;
      addTimelineEvent(totalTime, 'âœ… ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ›´æ–°å®Œäº†');
    });

    return { ...cacheResult, source: 'Cache (æ›´æ–°ä¸­)' };
  }

  addTimelineEvent(0, 'â„¹ï¸ åˆå›å–å¾—ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰');
  const result = await fetchFromNetwork(delay);
  cache = result.data;
  updateCacheStatus();
  return { ...result, source: 'Network (First time)' };
}

// ãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Ÿè¡Œ
fetchBtn.addEventListener('click', async () => {
  requestCount++;
  timelineContent.innerHTML = '';
  fetchBtn.disabled = true;
  fetchBtn.style.opacity = '0.6';
  responseContent.innerHTML = '<div class="response-empty">èª­ã¿è¾¼ã¿ä¸­...</div>';

  const delay = networkDelayCheckbox.checked ? 1500 : 100;
  const startTime = Date.now();

  let result;
  try {
    switch (currentStrategy) {
      case 'network-first':
        result = await networkFirst(delay);
        break;
      case 'cache-first':
        result = await cacheFirst(delay);
        break;
      case 'stale-while-revalidate':
        result = await staleWhileRevalidate(delay);
        break;
    }

    loadTime.textContent = result.elapsed + 'ms';
    dataSource.textContent = result.source;

    responseContent.innerHTML = \`
      <div class="response-data">
        <div>å†…å®¹: \${result.data.content}</div>
        <div>å–å¾—æ™‚åˆ»: \${result.data.timestamp}</div>
        <div>ãƒãƒ¼ã‚¸ãƒ§ãƒ³: v\${result.data.version}</div>
      </div>
    \`;
  } catch (error) {
    responseContent.innerHTML = \`<div style="color: #ef4444;">\${error.message}</div>\`;
    loadTime.textContent = '-';
    dataSource.textContent = 'Error';
  }

  fetchBtn.disabled = false;
  fetchBtn.style.opacity = '1';
});

// ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
clearCacheBtn.addEventListener('click', () => {
  cache = null;
  updateCacheStatus();
  addTimelineEvent(0, 'ğŸ—‘ï¸ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
  responseContent.innerHTML = '<div class="response-empty">ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ</div>';
  loadTime.textContent = '-';
  dataSource.textContent = '-';
});

function updateCacheStatus() {
  cacheStatus.textContent = cache ? 'ã‚ã‚Š' : 'ç©º';
  cacheStatus.style.color = cache ? '#10b981' : '#9ca3af';
}
  `}
/>

## æˆ¦ç•¥1: Network Firstï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å„ªå…ˆï¼‰

### ä»•çµ„ã¿

1. ã¾ãšãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
2. æˆåŠŸã—ãŸã‚‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
3. å¤±æ•—ã—ãŸã‚‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—

### ã‚³ãƒ¼ãƒ‰å®Ÿè£…

```javascript
// Service Worker ã§ã® Network First å®Ÿè£…
self.addEventListener('fetch', (event) => {
  event.respondWith(
    fetch(event.request)
      .then((response) => {
        // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
        const responseToCache = response.clone();
        caches.open('my-cache-v1').then((cache) => {
          cache.put(event.request, responseToCache);
        });
        return response;
      })
      .catch(() => {
        // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¤±æ•—æ™‚ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰
        return caches.match(event.request);
      })
  );
});
```

### æœ€é©ãªç”¨é€”

- **API ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã€è¨­å®šãƒ‡ãƒ¼ã‚¿ãªã©
- **ãƒ‹ãƒ¥ãƒ¼ã‚¹è¨˜äº‹**: å¸¸ã«æœ€æ–°ç‰ˆã‚’å–å¾—ã—ãŸã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
- **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ãŒé‡è¦ãªãƒ‡ãƒ¼ã‚¿

### ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

**ãƒ¡ãƒªãƒƒãƒˆ:**
- å¸¸ã«æœ€æ–°ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã‚‹
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã§ã‚‚å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºå¯èƒ½

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:**
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒé…ã„ã¨è¡¨ç¤ºã‚‚é…ããªã‚‹
- ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ™‚ã¯å¸¸ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒç™ºç”Ÿ

## æˆ¦ç•¥2: Cache Firstï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥å„ªå…ˆï¼‰

### ä»•çµ„ã¿

1. ã¾ãšã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç¢ºèª
2. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ã‚Œã°ãã‚Œã‚’è¿”ã™
3. ãªã‘ã‚Œã°ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰å–å¾—ã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜

### ã‚³ãƒ¼ãƒ‰å®Ÿè£…

```javascript
// Service Worker ã§ã® Cache First å®Ÿè£…
self.addEventListener('fetch', (event) => {
  event.respondWith(
    caches.match(event.request).then((cachedResponse) => {
      if (cachedResponse) {
        return cachedResponse;
      }

      return fetch(event.request).then((response) => {
        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
        const responseToCache = response.clone();
        caches.open('my-cache-v1').then((cache) => {
          cache.put(event.request, responseToCache);
        });
        return response;
      });
    })
  );
});
```

### æœ€é©ãªç”¨é€”

- **é™çš„ã‚¢ã‚»ãƒƒãƒˆ**: CSSã€JavaScriptã€ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
- **ç”»åƒ**: ãƒ­ã‚´ã€ã‚¢ã‚¤ã‚³ãƒ³ã€è£½å“ç”»åƒ
- **å¤‰æ›´é »åº¦ã®ä½ã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„**: åˆ©ç”¨è¦ç´„ã€FAQ ãªã©

### ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

**ãƒ¡ãƒªãƒƒãƒˆ:**
- è¶…é«˜é€Ÿï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å³åº§ã«è¿”ã™ï¼‰
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚‚å®Œå…¨ã«å‹•ä½œ
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’å‰Šæ¸›

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:**
- å¤ã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒè¡¨ç¤ºã•ã‚Œã‚‹å¯èƒ½æ€§
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ›´æ–°ã™ã‚‹ã¾ã§å¤‰æ›´ãŒåæ˜ ã•ã‚Œãªã„

## æˆ¦ç•¥3: Stale While Revalidateï¼ˆå¤ã„ã‚‚ã®ã‚’è¿”ã—ã¦æ›´æ–°ï¼‰

### ä»•çµ„ã¿

1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å³åº§ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™
2. åŒæ™‚ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ã‚‚å–å¾—
3. å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ›´æ–°ï¼ˆæ¬¡å›ç”¨ï¼‰

### ã‚³ãƒ¼ãƒ‰å®Ÿè£…

```javascript
// Service Worker ã§ã® Stale While Revalidate å®Ÿè£…
self.addEventListener('fetch', (event) => {
  event.respondWith(
    caches.open('my-cache-v1').then((cache) => {
      return cache.match(event.request).then((cachedResponse) => {
        const fetchPromise = fetch(event.request).then((networkResponse) => {
          // ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ›´æ–°
          cache.put(event.request, networkResponse.clone());
          return networkResponse;
        });

        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã‚Œã°å³åº§ã«è¿”ã™
        return cachedResponse || fetchPromise;
      });
    })
  );
});
```

### æœ€é©ãªç”¨é€”

- **ã‚¢ãƒã‚¿ãƒ¼ç”»åƒ**: ã™ãè¡¨ç¤ºã—ãŸã„ãŒã€æœ€æ–°ç‰ˆã‚‚æ¬²ã—ã„
- **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**: å¤ã„è¨­å®šã§èµ·å‹•ã—ã¦ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§æ›´æ–°
- **é »ç¹ã«å¤‰ã‚ã‚‹ãŒå³åº§ã«è¡¨ç¤ºã—ãŸã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„**

### ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

**ãƒ¡ãƒªãƒƒãƒˆ:**
- è¶…é«˜é€Ÿï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å³åº§ã«è¿”ã™ï¼‰
- è‡ªå‹•çš„ã«æœ€æ–°ç‰ˆã«æ›´æ–°ã•ã‚Œã‚‹
- æœ€é«˜ã® UXï¼ˆé€Ÿåº¦ã¨æ–°é®®ã•ã®ä¸¡ç«‹ï¼‰

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:**
- åˆå›è¡¨ç¤ºã¯å¤ã„ãƒ‡ãƒ¼ã‚¿ã®å¯èƒ½æ€§
- ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰æ›´æ–°ã§ãƒãƒƒãƒ†ãƒªãƒ¼æ¶ˆè²»

## Service Worker ã®ç™»éŒ²

### åŸºæœ¬çš„ãªç™»éŒ²ã‚³ãƒ¼ãƒ‰

```javascript
// main.js
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js')
      .then((registration) => {
        console.log('Service Worker ç™»éŒ²æˆåŠŸ:', registration.scope);
      })
      .catch((error) => {
        console.log('Service Worker ç™»éŒ²å¤±æ•—:', error);
      });
  });
}
```

### Service Worker ã®åŸºæœ¬æ§‹é€ 

```javascript
// sw.js
const CACHE_VERSION = 'v1';
const CACHE_NAME = 'my-app-' + CACHE_VERSION;

// ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥
self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open(CACHE_NAME).then((cache) => {
      return cache.addAll([
        '/',
        '/index.html',
        '/styles.css',
        '/app.js',
        '/offline.html'
      ]);
    })
  );
});

// å¤ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤
self.addEventListener('activate', (event) => {
  event.waitUntil(
    caches.keys().then((cacheNames) => {
      return Promise.all(
        cacheNames
          .filter((name) => name !== CACHE_NAME)
          .map((name) => caches.delete(name))
      );
    })
  );
});

// fetch ã‚¤ãƒ™ãƒ³ãƒˆã§æˆ¦ç•¥ã‚’é©ç”¨
self.addEventListener('fetch', (event) => {
  const url = new URL(event.request.url);

  // é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã¯ Cache First
  if (url.pathname.match(/\.(css|js|png|jpg|svg|woff2?)$/)) {
    event.respondWith(cacheFirst(event.request));
  }
  // API ã¯ Network First
  else if (url.pathname.startsWith('/api/')) {
    event.respondWith(networkFirst(event.request));
  }
  // ãã®ä»–ã¯ Stale While Revalidate
  else {
    event.respondWith(staleWhileRevalidate(event.request));
  }
});

function cacheFirst(request) {
  return caches.match(request).then((cachedResponse) => {
    return cachedResponse || fetch(request).then((response) => {
      return caches.open(CACHE_NAME).then((cache) => {
        cache.put(request, response.clone());
        return response;
      });
    });
  });
}

function networkFirst(request) {
  return fetch(request)
    .then((response) => {
      return caches.open(CACHE_NAME).then((cache) => {
        cache.put(request, response.clone());
        return response;
      });
    })
    .catch(() => caches.match(request));
}

function staleWhileRevalidate(request) {
  return caches.open(CACHE_NAME).then((cache) => {
    return cache.match(request).then((cachedResponse) => {
      const fetchPromise = fetch(request).then((networkResponse) => {
        cache.put(request, networkResponse.clone());
        return networkResponse;
      });
      return cachedResponse || fetchPromise;
    });
  });
}
```

## ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†

### ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—æ™‚ã®å‡¦ç†

```javascript
const CACHE_VERSION = 'v2'; // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸Šã’ã‚‹
const CACHE_NAME = 'my-app-' + CACHE_VERSION;

self.addEventListener('activate', (event) => {
  event.waitUntil(
    caches.keys().then((cacheNames) => {
      return Promise.all(
        cacheNames
          .filter((name) => {
            // ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä»¥å¤–ã‚’å‰Šé™¤
            return name.startsWith('my-app-') && name !== CACHE_NAME;
          })
          .map((name) => {
            console.log('å¤ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤:', name);
            return caches.delete(name);
          })
      );
    })
  );
});
```

## ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

### ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å°‚ç”¨ãƒšãƒ¼ã‚¸ã®ç”¨æ„

```javascript
// sw.js
self.addEventListener('fetch', (event) => {
  event.respondWith(
    fetch(event.request)
      .catch(() => {
        // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼æ™‚
        return caches.match(event.request)
          .then((cachedResponse) => {
            // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚‚ãªã„å ´åˆã¯ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
            return cachedResponse || caches.match('/offline.html');
          });
      })
  );
});
```

```html
<!-- offline.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚ªãƒ•ãƒ©ã‚¤ãƒ³</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      font-family: sans-serif;
      background: #0c1218;
      color: #e5edf4;
    }
    h1 { font-size: 3rem; margin: 0; }
    p { font-size: 1.25rem; color: #9ca3af; }
  </style>
</head>
<body>
  <h1>ğŸ“¡</h1>
  <h1>ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã™</h1>
  <p>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„</p>
</body>
</html>
```

## Chrome DevTools ã§ã®ãƒ‡ãƒãƒƒã‚°

### Application ã‚¿ãƒ–ã®æ´»ç”¨

1. **Service Workers ã‚»ã‚¯ã‚·ãƒ§ãƒ³**
   - ç™»éŒ²çŠ¶æ…‹ã®ç¢ºèª
   - Update on reload ã‚ªãƒ—ã‚·ãƒ§ãƒ³
   - Unregister ã§å‰Šé™¤

2. **Cache Storage**
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ä¸­èº«ã‚’ç¢ºèª
   - å€‹åˆ¥å‰Šé™¤ã‚„ä¸€æ‹¬å‰Šé™¤

3. **Offline ãƒ¢ãƒ¼ãƒ‰**
   - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ç„¡åŠ¹åŒ–ã—ã¦ãƒ†ã‚¹ãƒˆ

### ãƒ‡ãƒãƒƒã‚°Tips

```javascript
// sw.js ã§ã®ãƒ­ã‚°å‡ºåŠ›
self.addEventListener('fetch', (event) => {
  console.log('Fetch:', event.request.url);

  event.respondWith(
    caches.match(event.request).then((response) => {
      console.log('Cache hit:', !!response);
      return response || fetch(event.request);
    })
  );
});
```

## å®Ÿè·µçš„ãªè¨­å®šä¾‹

### é™çš„ã‚µã‚¤ãƒˆå‘ã‘

```javascript
// é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã¯ Cache Firstã€HTML ã¯ Network First
self.addEventListener('fetch', (event) => {
  const { request } = event;
  const url = new URL(request.url);

  // ç”»åƒã€CSSã€JS ã¯ Cache First
  if (request.destination === 'image' ||
      request.destination === 'style' ||
      request.destination === 'script') {
    event.respondWith(cacheFirst(request));
  }
  // HTML ã¯ Network First
  else if (request.destination === 'document') {
    event.respondWith(networkFirst(request));
  }
});
```

### SPAï¼ˆSingle Page Applicationï¼‰å‘ã‘

```javascript
// SPA ã¯ Stale While Revalidate ãŒãƒ™ã‚¹ãƒˆ
self.addEventListener('fetch', (event) => {
  const { request } = event;

  // API ä»¥å¤–ã¯ Stale While Revalidate
  if (!request.url.includes('/api/')) {
    event.respondWith(staleWhileRevalidate(request));
  }
  // API ã¯ Network First
  else {
    event.respondWith(networkFirst(request));
  }
});
```

## ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–

### 1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæ›´æ–°ã•ã‚Œãªã„

**åŸå› :** Service Worker ãŒã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„

**è§£æ±ºç­–:**
```javascript
// Update ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
navigator.serviceWorker.register('/sw.js').then((registration) => {
  // 24æ™‚é–“ã”ã¨ã«æ›´æ–°ãƒã‚§ãƒƒã‚¯
  setInterval(() => {
    registration.update();
  }, 24 * 60 * 60 * 1000);
});
```

### 2. é–‹ç™ºä¸­ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒé‚ªé­”

**è§£æ±ºç­–:** DevTools ã§ "Update on reload" ã‚’æœ‰åŠ¹åŒ–

### 3. HTTPS ã§ã—ã‹å‹•ã‹ãªã„

**åŸå› :** Service Worker ã¯ HTTPS å¿…é ˆï¼ˆlocalhost ã¯ä¾‹å¤–ï¼‰

**è§£æ±ºç­–:** æœ¬ç•ªç’°å¢ƒã§ã¯å¿…ãš HTTPS ã‚’ä½¿ç”¨

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ã”ã¨ã«é©åˆ‡ãªæˆ¦ç•¥ã‚’é¸æŠ
- [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‚’å®Ÿè£…
- [ ] ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒšãƒ¼ã‚¸ã‚’ç”¨æ„
- [ ] Chrome DevTools ã§ãƒ†ã‚¹ãƒˆ
- [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µã‚¤ã‚ºã«æ³¨æ„ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶åˆ¶é™ã‚ã‚Šï¼‰
- [ ] å¤ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ activate æ™‚ã«å‰Šé™¤
- [ ] update() ã§å®šæœŸçš„ã« Service Worker ã‚’æ›´æ–°

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™

| æˆ¦ç•¥ | åˆå›èª­ã¿è¾¼ã¿ | 2å›ç›®ä»¥é™ | ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ | æ–°é®®ã• |
|------|-------------|-----------|----------|--------|
| Network First | é…ã„ | é…ã„ | å¯èƒ½ | å¸¸ã«æœ€æ–° |
| Cache First | é…ã„ | è¶…é«˜é€Ÿ | å¯èƒ½ | å¤ã„å¯èƒ½æ€§ |
| Stale While Revalidate | é…ã„ | è¶…é«˜é€Ÿ | å¯èƒ½ | æ¬¡å›æœ€æ–° |

## ã¾ã¨ã‚

1. **Network First** - API ã‚„å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«æœ€é©
2. **Cache First** - é™çš„ã‚¢ã‚»ãƒƒãƒˆã§è¶…é«˜é€Ÿè¡¨ç¤º
3. **Stale While Revalidate** - é€Ÿåº¦ã¨æ–°é®®ã•ã®ä¸¡ç«‹

ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦é©åˆ‡ãªæˆ¦ç•¥ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€æœ€é«˜ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚

## å‚è€ƒãƒªãƒ³ã‚¯

- [Service Worker API - MDN](https://developer.mozilla.org/ja/docs/Web/API/Service_Worker_API)
- [The Offline Cookbook - web.dev](https://web.dev/offline-cookbook/)
- [Workbox - Google](https://developers.google.com/web/tools/workbox)
- [Service Worker ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle)
