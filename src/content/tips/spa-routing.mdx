---
title: SPA ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ï¼‰
description: ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ãªã—ã§ç”»é¢é·ç§»ã‚’å®Ÿç¾ã™ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®å®Ÿè£…
tags: [spa, routing, history-api, navigation, webapp]
category: webapp
level: intermediate
date: 2025-11-12
---

import LiveDemo from '../../components/LiveDemo.astro';

## SPA ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨ã¯

**æ™®é€šã®Webã‚µã‚¤ãƒˆ**: ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ç”»é¢ãŒçœŸã£ç™½ã«ãªã£ã¦æ–°ã—ã„ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹
**SPA**: ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚ç”»é¢ãŒçœŸã£ç™½ã«ãªã‚‰ãšã€ã™ãã«æ¬¡ã®ç”»é¢ã«åˆ‡ã‚Šæ›¿ã‚ã‚‹

ä¾‹ãˆã°ã€YouTubeã§å‹•ç”»ã‚’è¦‹ã¦ã„ã‚‹ã¨ãã«åˆ¥ã®å‹•ç”»ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚ã€ãƒšãƒ¼ã‚¸å…¨ä½“ãŒèª­ã¿è¾¼ã¿ç›´ã—ã«ãªã‚‰ãšã‚¹ãƒ ãƒ¼ã‚ºã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã‚ˆã­ã€‚ãã‚ŒãŒSPAï¼ˆã‚·ãƒ³ã‚°ãƒ«ãƒšãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã§ã™ã€‚

ã“ã®æŠ€è¡“ã‚’ä½¿ã†ã¨ï¼š
- ãƒšãƒ¼ã‚¸åˆ‡ã‚Šæ›¿ãˆãŒé€Ÿã„ï¼ˆèª­ã¿è¾¼ã¿å¾…ã¡ãŒãªã„ï¼‰
- å‹•ç”»ã‚„éŸ³æ¥½ãŒé€”åˆ‡ã‚Œãªã„
- ã‚¹ãƒãƒ›ã‚¢ãƒ—ãƒªã¿ãŸã„ãªæ“ä½œæ„Ÿ

## åŸºæœ¬çš„ãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®å®Ÿè£…

<LiveDemo
  title="SPA ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ãƒ‡ãƒ¢"
  height="700px"
  html={`
<div class="spa-demo">
  <div class="demo-header">
    <h3>ğŸš€ SPA ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‡ãƒ¢</h3>
    <p class="subtitle">ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ãªã—ã§ç”»é¢é·ç§»</p>
  </div>

  <div class="browser-mockup">
    <div class="browser-chrome">
      <div class="browser-dots">
        <span class="dot"></span>
        <span class="dot"></span>
        <span class="dot"></span>
      </div>
      <div class="address-bar">
        <span class="protocol">ğŸ”’</span>
        <span class="url" id="addressBar">myapp.com/</span>
      </div>
    </div>

    <div class="browser-content">
      <nav class="app-nav">
        <a href="/" class="nav-link active" data-link>
          <span class="nav-icon">ğŸ </span>
          <span>ãƒ›ãƒ¼ãƒ </span>
        </a>
        <a href="/about" class="nav-link" data-link>
          <span class="nav-icon">â„¹ï¸</span>
          <span>ã‚¢ãƒã‚¦ãƒˆ</span>
        </a>
        <a href="/products" class="nav-link" data-link>
          <span class="nav-icon">ğŸ“¦</span>
          <span>è£½å“</span>
        </a>
        <a href="/contact" class="nav-link" data-link>
          <span class="nav-icon">âœ‰ï¸</span>
          <span>ãŠå•ã„åˆã‚ã›</span>
        </a>
      </nav>

      <div class="page-content" id="pageContent">
        <!-- ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
      </div>

      <div class="loading-bar" id="loadingBar"></div>
    </div>
  </div>

  <div class="control-panel">
    <div class="history-controls">
      <button class="history-btn" id="backBtn" disabled>
        <span>â†</span>
        <span>æˆ»ã‚‹</span>
      </button>
      <button class="history-btn" id="forwardBtn" disabled>
        <span>é€²ã‚€</span>
        <span>â†’</span>
      </button>
      <div class="history-position">
        <span id="historyInfo">å±¥æ­´: 0 / 0</span>
      </div>
    </div>
  </div>

  <div class="event-log">
    <div class="log-header">ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¤ãƒ™ãƒ³ãƒˆ</div>
    <div class="log-content" id="logContent">
      <div class="log-empty">ã‚¤ãƒ™ãƒ³ãƒˆã‚’å¾…æ©Ÿä¸­...</div>
    </div>
  </div>
</div>
  `}
  css={`
.spa-demo {
  max-width: 900px;
  margin: 0 auto;
  padding: 1.5rem;
}

.demo-header {
  text-align: center;
  margin-bottom: 2rem;
}

.demo-header h3 {
  margin: 0 0 0.5rem 0;
  font-size: 1.5rem;
  color: #e5edf4;
}

.subtitle {
  margin: 0;
  color: #9ca3af;
  font-size: 0.9375rem;
}

.browser-mockup {
  background: #1f2a37;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
  margin-bottom: 1.5rem;
}

.browser-chrome {
  background: #374151;
  padding: 0.75rem 1rem;
  display: flex;
  align-items: center;
  gap: 1rem;
}

.browser-dots {
  display: flex;
  gap: 0.5rem;
}

.dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: #ef4444;
}

.dot:nth-child(2) {
  background: #f59e0b;
}

.dot:nth-child(3) {
  background: #10b981;
}

.address-bar {
  flex: 1;
  background: #1f2a37;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-family: monospace;
  font-size: 0.875rem;
}

.protocol {
  font-size: 0.875rem;
}

.url {
  color: #e5edf4;
}

.browser-content {
  background: #0c1218;
  min-height: 400px;
  position: relative;
}

.app-nav {
  display: flex;
  background: #1f2a37;
  border-bottom: 1px solid #374151;
}

.nav-link {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 1rem 1.5rem;
  color: #9ca3af;
  text-decoration: none;
  border-bottom: 2px solid transparent;
  transition: all 0.2s;
  cursor: pointer;
}

.nav-link:hover {
  color: #e5edf4;
  background: #374151;
}

.nav-link.active {
  color: #60a5fa;
  border-bottom-color: #60a5fa;
}

.nav-icon {
  font-size: 1.25rem;
}

.page-content {
  padding: 2rem;
  animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.page-title {
  font-size: 2rem;
  margin: 0 0 1rem 0;
  color: #e5edf4;
}

.page-description {
  color: #9ca3af;
  margin: 0 0 2rem 0;
  line-height: 1.6;
}

.page-card {
  background: #1f2a37;
  border-radius: 8px;
  padding: 1.5rem;
  margin-bottom: 1rem;
}

.card-title {
  color: #e5edf4;
  margin: 0 0 0.5rem 0;
}

.card-text {
  color: #9ca3af;
  margin: 0;
  font-size: 0.9375rem;
}

.loading-bar {
  position: absolute;
  top: 0;
  left: 0;
  height: 3px;
  background: linear-gradient(90deg, #60a5fa, #3b82f6);
  width: 0;
  transition: width 0.3s ease-out;
  opacity: 0;
}

.loading-bar.loading {
  opacity: 1;
  animation: loadProgress 0.5s ease-out forwards;
}

@keyframes loadProgress {
  to {
    width: 100%;
  }
}

.control-panel {
  background: #1f2a37;
  border-radius: 8px;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
}

.history-controls {
  display: flex;
  gap: 1rem;
  align-items: center;
}

.history-btn {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1.25rem;
  background: #374151;
  border: 1px solid #4b5563;
  border-radius: 8px;
  color: #e5edf4;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.history-btn:hover:not(:disabled) {
  background: #4b5563;
  transform: translateY(-2px);
}

.history-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.history-position {
  flex: 1;
  text-align: center;
  color: #9ca3af;
  font-size: 0.9375rem;
  font-weight: 600;
}

.event-log {
  background: #1f2a37;
  border-radius: 8px;
  padding: 1.5rem;
}

.log-header {
  font-size: 0.9375rem;
  font-weight: 600;
  color: #e5edf4;
  margin-bottom: 1rem;
}

.log-content {
  background: #0c1218;
  border-radius: 6px;
  padding: 1rem;
  max-height: 200px;
  overflow-y: auto;
}

.log-empty {
  text-align: center;
  color: #6b7280;
  font-size: 0.875rem;
  padding: 1rem;
}

.log-entry {
  display: flex;
  align-items: start;
  gap: 0.75rem;
  padding: 0.75rem;
  margin-bottom: 0.5rem;
  background: #1f2a37;
  border-radius: 6px;
  font-size: 0.875rem;
  animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(-10px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.log-time {
  color: #60a5fa;
  font-weight: 600;
  min-width: 65px;
  font-family: monospace;
}

.log-message {
  color: #d1d5db;
  flex: 1;
}

.log-route {
  color: #10b981;
  font-weight: 600;
}
  `}
  js={`
// ãƒšãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
const pages = {
  '/': {
    title: 'ãƒ›ãƒ¼ãƒ ',
    content: \`
      <h2 class="page-title">ğŸ  ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</h2>
      <p class="page-description">SPAãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ãƒ‡ãƒ¢ã¸ã‚ˆã†ã“ãï¼ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã›ãšã«ç”»é¢é·ç§»ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚</p>
      <div class="page-card">
        <h3 class="card-title">æœ€æ–°æƒ…å ±</h3>
        <p class="card-text">SPAï¼ˆSingle Page Applicationï¼‰ã§ã¯ã€ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’äº‹å‰ã«èª­ã¿è¾¼ã‚“ã ã‚Šã€å¿…è¦ã«å¿œã˜ã¦å‹•çš„ã«å–å¾—ã—ãŸã‚Šã—ã¾ã™ã€‚</p>
      </div>
      <div class="page-card">
        <h3 class="card-title">ç‰¹å¾´</h3>
        <p class="card-text">âœ“ é«˜é€Ÿãªç”»é¢é·ç§»<br>âœ“ ã‚¹ãƒ ãƒ¼ã‚ºãªãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“<br>âœ“ çŠ¶æ…‹ã®ä¿æŒãŒå®¹æ˜“</p>
      </div>
    \`
  },
  '/about': {
    title: 'ã‚¢ãƒã‚¦ãƒˆ',
    content: \`
      <h2 class="page-title">â„¹ï¸ ã‚¢ãƒã‚¦ãƒˆ</h2>
      <p class="page-description">ã“ã®ãƒ‡ãƒ¢ã«ã¤ã„ã¦ã®è©³ç´°æƒ…å ±ã§ã™ã€‚</p>
      <div class="page-card">
        <h3 class="card-title">æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯</h3>
        <p class="card-text">History APIã€addEventListenerã€ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚</p>
      </div>
      <div class="page-card">
        <h3 class="card-title">å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ</h3>
        <p class="card-text">
          1. history.pushState() ã§URLã‚’å¤‰æ›´<br>
          2. popstate ã‚¤ãƒ™ãƒ³ãƒˆã§æˆ»ã‚‹/é€²ã‚€ã«å¯¾å¿œ<br>
          3. ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆ<br>
          4. å‹•çš„ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æ›´æ–°
        </p>
      </div>
    \`
  },
  '/products': {
    title: 'è£½å“',
    content: \`
      <h2 class="page-title">ğŸ“¦ è£½å“ä¸€è¦§</h2>
      <p class="page-description">ç§ãŸã¡ã®è£½å“ã‚’ã”è¦§ãã ã•ã„ã€‚</p>
      <div class="page-card">
        <h3 class="card-title">è£½å“ A</h3>
        <p class="card-text">é«˜å“è³ªã§ä½¿ã„ã‚„ã™ã„è£½å“ã§ã™ã€‚</p>
      </div>
      <div class="page-card">
        <h3 class="card-title">è£½å“ B</h3>
        <p class="card-text">é©æ–°çš„ãªæ©Ÿèƒ½ã‚’æ­è¼‰ã—ãŸæ¬¡ä¸–ä»£è£½å“ã€‚</p>
      </div>
      <div class="page-card">
        <h3 class="card-title">è£½å“ C</h3>
        <p class="card-text">ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå‘ã‘ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã€‚</p>
      </div>
    \`
  },
  '/contact': {
    title: 'ãŠå•ã„åˆã‚ã›',
    content: \`
      <h2 class="page-title">âœ‰ï¸ ãŠå•ã„åˆã‚ã›</h2>
      <p class="page-description">ã”è³ªå•ã‚„ã”ç›¸è«‡ãŒã‚ã‚Šã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ã”é€£çµ¡ãã ã•ã„ã€‚</p>
      <div class="page-card">
        <h3 class="card-title">é€£çµ¡å…ˆ</h3>
        <p class="card-text">
          Email: info@example.com<br>
          Tel: 03-1234-5678<br>
          å–¶æ¥­æ™‚é–“: å¹³æ—¥ 9:00-18:00
        </p>
      </div>
      <div class="page-card">
        <h3 class="card-title">æ‰€åœ¨åœ°</h3>
        <p class="card-text">
          ã€’100-0001<br>
          æ±äº¬éƒ½åƒä»£ç”°åŒºåƒä»£ç”°1-1
        </p>
      </div>
    \`
  }
};

const addressBar = document.getElementById('addressBar');
const pageContent = document.getElementById('pageContent');
const logContent = document.getElementById('logContent');
const loadingBar = document.getElementById('loadingBar');
const backBtn = document.getElementById('backBtn');
const forwardBtn = document.getElementById('forwardBtn');
const historyInfo = document.getElementById('historyInfo');

let historyStack = ['/'];
let historyPosition = 0;

// ãƒ­ã‚°è¿½åŠ 
function addLog(message, route = null) {
  if (logContent.querySelector('.log-empty')) {
    logContent.innerHTML = '';
  }

  const entry = document.createElement('div');
  entry.className = 'log-entry';
  const now = new Date();
  const timeStr = now.toLocaleTimeString('ja-JP', {
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  });

  const routeHtml = route ? \` <span class="log-route">\${route}</span>\` : '';
  entry.innerHTML = \`
    <span class="log-time">\${timeStr}</span>
    <span class="log-message">\${message}\${routeHtml}</span>
  \`;

  logContent.insertBefore(entry, logContent.firstChild);

  while (logContent.children.length > 10) {
    logContent.removeChild(logContent.lastChild);
  }
}

// å±¥æ­´æƒ…å ±ã®æ›´æ–°
function updateHistoryInfo() {
  historyInfo.textContent = \`å±¥æ­´: \${historyPosition + 1} / \${historyStack.length}\`;
  backBtn.disabled = historyPosition === 0;
  forwardBtn.disabled = historyPosition === historyStack.length - 1;
}

// ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
function showLoading() {
  loadingBar.style.width = '0';
  loadingBar.classList.add('loading');
  setTimeout(() => {
    loadingBar.classList.remove('loading');
  }, 500);
}

// ãƒšãƒ¼ã‚¸ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
function renderPage(path) {
  const page = pages[path] || pages['/'];

  showLoading();

  setTimeout(() => {
    pageContent.innerHTML = page.content;
    addressBar.textContent = \`myapp.com\${path}\`;
    document.title = \`\${page.title} - SPA Demo\`;

    // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
    document.querySelectorAll('.nav-link').forEach(link => {
      link.classList.remove('active');
      if (link.getAttribute('href') === path) {
        link.classList.add('active');
      }
    });

    addLog('ãƒšãƒ¼ã‚¸ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°:', path);
  }, 100);
}

// ãƒ«ãƒ¼ãƒˆå¤‰æ›´
function navigateTo(path, addToHistory = true) {
  if (addToHistory) {
    // ç¾åœ¨ä½ç½®ã‚ˆã‚Šå¾Œã‚ã®å±¥æ­´ã‚’å‰Šé™¤
    historyStack = historyStack.slice(0, historyPosition + 1);
    historyStack.push(path);
    historyPosition = historyStack.length - 1;

    history.pushState({ path }, '', path);
    addLog('history.pushState():', path);
  }

  renderPage(path);
  updateHistoryInfo();
}

// ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯ã®ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆ
document.addEventListener('click', (e) => {
  const link = e.target.closest('[data-link]');
  if (link) {
    e.preventDefault();
    const path = link.getAttribute('href');
    navigateTo(path);
  }
});

// popstate ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆæˆ»ã‚‹/é€²ã‚€ï¼‰
window.addEventListener('popstate', (e) => {
  if (e.state && e.state.path) {
    addLog('popstate ã‚¤ãƒ™ãƒ³ãƒˆ:', e.state.path);
    renderPage(e.state.path);
  }
});

// æˆ»ã‚‹ãƒœã‚¿ãƒ³
backBtn.addEventListener('click', () => {
  if (historyPosition > 0) {
    historyPosition--;
    const path = historyStack[historyPosition];
    history.back();
    addLog('æˆ»ã‚‹:', path);
  }
});

// é€²ã‚€ãƒœã‚¿ãƒ³
forwardBtn.addEventListener('click', () => {
  if (historyPosition < historyStack.length - 1) {
    historyPosition++;
    const path = historyStack[historyPosition];
    history.forward();
    addLog('é€²ã‚€:', path);
  }
});

// åˆæœŸåŒ–
addLog('SPA ãƒ«ãƒ¼ã‚¿ãƒ¼åˆæœŸåŒ–');
renderPage('/');
updateHistoryInfo();
  `}
/>

## ã©ã†ã‚„ã£ã¦å®Ÿç¾ã™ã‚‹ã®ï¼Ÿ

### ä»•çµ„ã¿1: URLã‚’å¤‰ãˆã‚‹ï¼ˆã§ã‚‚ãƒšãƒ¼ã‚¸ã¯èª­ã¿è¾¼ã¾ãªã„ï¼‰

æ™®é€šã€URLãŒå¤‰ã‚ã‚‹ã¨æ–°ã—ã„ãƒšãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚ã§ã‚‚ã€JavaScriptã‚’ä½¿ã†ã¨ã€ŒURLã ã‘å¤‰ãˆã¦ã€ãƒšãƒ¼ã‚¸ã¯èª­ã¿è¾¼ã¾ãªã„ã€ã“ã¨ãŒã§ãã¾ã™ã€‚

```javascript
// ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã®URLã‚’ /about ã«å¤‰ãˆã‚‹ï¼ˆã§ã‚‚ãƒšãƒ¼ã‚¸ã¯ãã®ã¾ã¾ï¼‰
history.pushState(null, '', '/about');
```

ã“ã‚Œã¯ã€æœ¬ã®ã—ãŠã‚Šã‚’ç§»å‹•ã™ã‚‹ã‚ˆã†ãªæ„Ÿã˜ã§ã™ã€‚æœ¬ã¯åŒã˜ã ã‘ã©ã€ä»Šã©ã“ã‚’èª­ã‚“ã§ã„ã‚‹ã‹ï¼ˆURLï¼‰ã ã‘å¤‰ã‚ã‚Šã¾ã™ã€‚

### ä»•çµ„ã¿2: æˆ»ã‚‹ãƒœã‚¿ãƒ³ã«å¯¾å¿œã™ã‚‹

ãƒ–ãƒ©ã‚¦ã‚¶ã®ã€Œæˆ»ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã«ã€å‰ã®ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```javascript
// ã€Œæˆ»ã‚‹ã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‚‰å®Ÿè¡Œã•ã‚Œã‚‹
window.addEventListener('popstate', () => {
  // ä»Šã®URLã‚’è¦‹ã¦ã€è¡¨ç¤ºã™ã‚‹ãƒšãƒ¼ã‚¸ã‚’æ±ºã‚ã‚‹
  è¡¨ç¤ºã™ã‚‹ãƒšãƒ¼ã‚¸ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹();
});
```

## å®Ÿéš›ã«ä½œã£ã¦ã¿ã‚ˆã†

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒšãƒ¼ã‚¸ã®HTMLã‚’ç”¨æ„

```html
<!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼‰ -->
<nav>
  <a href="/" class="link">ãƒ›ãƒ¼ãƒ </a>
  <a href="/about" class="link">ã‚¢ãƒã‚¦ãƒˆ</a>
  <a href="/contact" class="link">ãŠå•ã„åˆã‚ã›</a>
</nav>

<!-- ã“ã“ã«ãƒšãƒ¼ã‚¸ã®å†…å®¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ -->
<div id="page">
  <!-- ãƒšãƒ¼ã‚¸å†…å®¹ãŒã“ã“ã«å…¥ã‚‹ -->
</div>
```

### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã®å‡¦ç†

```javascript
// ã™ã¹ã¦ã®ãƒªãƒ³ã‚¯ã«å¯¾ã—ã¦
document.querySelectorAll('.link').forEach(link => {
  link.addEventListener('click', (e) => {
    e.preventDefault(); // æ™®é€šã®ãƒšãƒ¼ã‚¸ç§»å‹•ã‚’æ­¢ã‚ã‚‹

    const url = link.getAttribute('href'); // ã‚¯ãƒªãƒƒã‚¯ã—ãŸãƒªãƒ³ã‚¯å…ˆ
    history.pushState(null, '', url); // URLã‚’å¤‰æ›´

    showPage(url); // ãƒšãƒ¼ã‚¸å†…å®¹ã‚’è¡¨ç¤º
  });
});
```

### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒšãƒ¼ã‚¸å†…å®¹ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°

```javascript
function showPage(url) {
  const pageDiv = document.getElementById('page');

  // URLã«å¿œã˜ã¦è¡¨ç¤ºã™ã‚‹å†…å®¹ã‚’æ±ºã‚ã‚‹
  if (url === '/') {
    pageDiv.innerHTML = '<h1>ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</h1><p>ã‚ˆã†ã“ãï¼</p>';
  } else if (url === '/about') {
    pageDiv.innerHTML = '<h1>ã‚¢ãƒã‚¦ãƒˆ</h1><p>ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦</p>';
  } else if (url === '/contact') {
    pageDiv.innerHTML = '<h1>ãŠå•ã„åˆã‚ã›</h1><p>é€£çµ¡å…ˆæƒ…å ±</p>';
  }
}
```

ã“ã‚Œã ã‘ã§ã€ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«ç”»é¢ãŒçœŸã£ç™½ã«ãªã‚‰ãšã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ï¼

## å¿œç”¨: URLã‹ã‚‰æƒ…å ±ã‚’å–ã‚Šå‡ºã™

ä¾‹ãˆã° `/user/123` ã¨ã„ã†URLã‹ã‚‰ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã€Œ123ã€ã‚’å–ã‚Šå‡ºã—ãŸã„ã¨ããŒã‚ã‚Šã¾ã™ã€‚

```javascript
function showPage(url) {
  const pageDiv = document.getElementById('page');

  // URLãŒ /user/â—‹â—‹ ã®å½¢ãªã‚‰
  if (url.startsWith('/user/')) {
    const userId = url.replace('/user/', ''); // 123 ãŒå–ã‚Œã‚‹
    pageDiv.innerHTML = `<h1>ãƒ¦ãƒ¼ã‚¶ãƒ¼ ${userId} ã®ãƒšãƒ¼ã‚¸</h1>`;
  }
}
```

ã“ã†ã™ã‚‹ã¨ï¼š
- `/user/1` â†’ ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ 1 ã®ãƒšãƒ¼ã‚¸ã€
- `/user/999` â†’ ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ 999 ã®ãƒšãƒ¼ã‚¸ã€

ã¨ã€URLã®æ•°å­—éƒ¨åˆ†ã‚’ä½¿ã£ã¦ãƒšãƒ¼ã‚¸ã‚’ä½œã‚Œã¾ã™ã€‚

## ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‡¦ç†

```javascript
function getQueryParams() {
  const params = new URLSearchParams(window.location.search);
  const result = {};
  for (const [key, value] of params) {
    result[key] = value;
  }
  return result;
}

// ä½¿ç”¨ä¾‹
// URL: /search?q=javascript&page=2
const params = getQueryParams();
console.log(params.q);     // 'javascript'
console.log(params.page);  // '2'

// ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ›´æ–°
function updateQueryParams(newParams) {
  const url = new URL(window.location);
  Object.keys(newParams).forEach(key => {
    url.searchParams.set(key, newParams[key]);
  });
  history.pushState(null, '', url);
}

updateQueryParams({ page: 3 });
```

## ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ãƒ¼ãƒ‰

### ãƒšãƒ¼ã‚¸é·ç§»å‰ã®ç¢ºèª

```javascript
class Router {
  constructor(routes, options = {}) {
    this.routes = routes;
    this.beforeEach = options.beforeEach || null;
    // ...
  }

  async navigateTo(url) {
    const path = new URL(url).pathname;

    // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œ
    if (this.beforeEach) {
      const shouldNavigate = await this.beforeEach(
        this.currentPath,
        path
      );

      if (!shouldNavigate) {
        console.log('Navigation cancelled');
        return;
      }
    }

    history.pushState(null, null, path);
    this.render(path);
  }
}

// ä½¿ç”¨ä¾‹ï¼šèªè¨¼ãƒã‚§ãƒƒã‚¯
const router = new Router(routes, {
  beforeEach: (from, to) => {
    // ä¿è­·ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆã‚’ãƒã‚§ãƒƒã‚¯
    if (to.startsWith('/admin') && !isAuthenticated()) {
      alert('ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™');
      router.navigateTo('/login');
      return false;
    }
    return true;
  }
});
```

## ãƒšãƒ¼ã‚¸é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

```javascript
class Router {
  async render(path) {
    const app = document.getElementById('app');

    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
    app.style.opacity = '0';
    await new Promise(resolve => setTimeout(resolve, 200));

    // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ›´æ–°
    const route = this.findRoute(path);
    app.innerHTML = route.component();

    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³
    app.style.opacity = '1';
  }
}
```

### CSS ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³

```css
#app {
  opacity: 1;
  transition: opacity 0.3s ease;
}

.page-enter {
  animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
```

## ãƒã‚¹ãƒˆãƒ«ãƒ¼ãƒˆ

```javascript
const routes = [
  {
    path: '/dashboard',
    component: DashboardLayout,
    children: [
      {
        path: '/dashboard/overview',
        component: Overview
      },
      {
        path: '/dashboard/settings',
        component: Settings
      }
    ]
  }
];

class Router {
  renderNested(routes, path, parentElement) {
    for (const route of routes) {
      if (path === route.path) {
        parentElement.innerHTML = route.component();

        if (route.children) {
          const childContainer = parentElement.querySelector('[data-child-view]');
          this.renderNested(route.children, path, childContainer);
        }
        return;
      }
    }
  }
}
```

## ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã®ç®¡ç†

```javascript
class Router {
  constructor(routes) {
    this.routes = routes;
    this.scrollPositions = new Map();

    window.addEventListener('popstate', () => {
      const path = window.location.pathname;
      this.render(path);

      // ä¿å­˜ã•ã‚ŒãŸä½ç½®ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
      if (this.scrollPositions.has(path)) {
        const pos = this.scrollPositions.get(path);
        window.scrollTo(pos.x, pos.y);
      } else {
        window.scrollTo(0, 0);
      }
    });
  }

  navigateTo(url) {
    const currentPath = window.location.pathname;

    // ç¾åœ¨ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’ä¿å­˜
    this.scrollPositions.set(currentPath, {
      x: window.scrollX,
      y: window.scrollY
    });

    const path = new URL(url).pathname;
    history.pushState(null, null, path);
    this.render(path);

    // æ–°ã—ã„ãƒšãƒ¼ã‚¸ã¯æœ€ä¸Šéƒ¨ã¸
    window.scrollTo(0, 0);
  }
}
```

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```javascript
class Router {
  constructor(routes) {
    this.routes = routes;
    this.notFoundHandler = () => '<h1>404 - Page Not Found</h1>';
    this.errorHandler = (error) => \`<h1>Error: \${error.message}</h1>\`;
  }

  async render(path) {
    try {
      const route = this.findRoute(path);

      if (!route) {
        // 404 ãƒšãƒ¼ã‚¸
        document.getElementById('app').innerHTML = this.notFoundHandler();
        return;
      }

      const content = await route.component();
      document.getElementById('app').innerHTML = content;

    } catch (error) {
      console.error('Rendering error:', error);
      document.getElementById('app').innerHTML = this.errorHandler(error);
    }
  }

  setNotFoundHandler(handler) {
    this.notFoundHandler = handler;
  }

  setErrorHandler(handler) {
    this.errorHandler = handler;
  }
}
```

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. SEO å¯¾ç­–

SPAã¯ã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼ã«å„ªã—ããªã„ãŸã‚ï¼š

- ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆSSRï¼‰ã‚’æ¤œè¨
- `<meta>` ã‚¿ã‚°ã‚’å‹•çš„ã«æ›´æ–°
- ã‚µã‚¤ãƒˆãƒãƒƒãƒ—ã‚’æä¾›

```javascript
function updateMetaTags(title, description) {
  document.title = title;

  let metaDesc = document.querySelector('meta[name="description"]');
  if (!metaDesc) {
    metaDesc = document.createElement('meta');
    metaDesc.name = 'description';
    document.head.appendChild(metaDesc);
  }
  metaDesc.content = description;
}
```

### 2. ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ã‚¨ãƒ³ãƒãƒ³ã‚¹ãƒ¡ãƒ³ãƒˆ

```html
<!-- JavaScriptç„¡åŠ¹æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ -->
<a href="/about" data-link>About</a>
```

### 3. ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯å¯¾ç­–

```javascript
class Router {
  cleanup() {
    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è§£é™¤
    window.removeEventListener('popstate', this.handlePopState);
    document.removeEventListener('click', this.handleClick);
  }
}
```

## ã¾ã¨ã‚

SPAãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’å®Ÿç¾ã™ã‚‹ã«ã¯ã€ã“ã®3ã¤ã ã‘è¦šãˆã‚Œã°OKï¼

1. **ãƒªãƒ³ã‚¯ã®ã‚¯ãƒªãƒƒã‚¯ã‚’ã‚­ãƒ£ãƒƒãƒ**
   - ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚‰æ™®é€šã®ãƒšãƒ¼ã‚¸ç§»å‹•ã‚’æ­¢ã‚ã‚‹

2. **URLã‚’å¤‰æ›´ï¼ˆã§ã‚‚ãƒšãƒ¼ã‚¸ã¯èª­ã¿è¾¼ã¾ãªã„ï¼‰**
   - `history.pushState()` ã‚’ä½¿ã†

3. **ãƒšãƒ¼ã‚¸å†…å®¹ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹**
   - URLã«åˆã‚ã›ã¦è¡¨ç¤ºã™ã‚‹å†…å®¹ã‚’å¤‰ãˆã‚‹

ã“ã‚Œã§ã€YouTubeã‚„Twitterã®ã‚ˆã†ãªã€Œã‚µã‚¯ã‚µã‚¯å‹•ãWebã‚µã‚¤ãƒˆã€ãŒä½œã‚Œã¾ã™ï¼

## å‚è€ƒãƒªãƒ³ã‚¯

- [History API - MDN](https://developer.mozilla.org/ja/docs/Web/API/History_API)
- [pushState - MDN](https://developer.mozilla.org/ja/docs/Web/API/History/pushState)
- [popstate event - MDN](https://developer.mozilla.org/ja/docs/Web/API/Window/popstate_event)
