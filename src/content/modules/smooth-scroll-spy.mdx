---
title: スムーススクロール + スクロールスパイ
description: アンカー移動をスムースにし、現在セクションをナビに反映。
tags: [scroll, navigation, ux]
frameworks: [Vanilla, Any]
level: intermediate
prompt_template: |
  内部リンク（a[href^="#"]）をスムーススクロール。現在セクションをnavに反映：
  - scroll-behavior: smooth を基本、古い環境はJS fallback
  - IntersectionObserverで現在セクションに .active を付与
---

import LiveDemo from '../../components/LiveDemo.astro';

<LiveDemo height="500px" html={`
<div style="background: #0c1218;">
  <nav class="nav" style="position: sticky; top: 0; background: #1f2a37; padding: 1rem 2rem; border-bottom: 1px solid #374151; z-index: 100;">
    <div style="display: flex; gap: 2rem; justify-content: center;">
      <a href="#intro" style="color: #9ca3af; text-decoration: none; padding: 0.5rem 1rem; border-radius: 6px; transition: all 0.2s ease;">イントロ</a>
      <a href="#features" style="color: #9ca3af; text-decoration: none; padding: 0.5rem 1rem; border-radius: 6px; transition: all 0.2s ease;">特徴</a>
      <a href="#benefits" style="color: #9ca3af; text-decoration: none; padding: 0.5rem 1rem; border-radius: 6px; transition: all 0.2s ease;">メリット</a>
      <a href="#conclusion" style="color: #9ca3af; text-decoration: none; padding: 0.5rem 1rem; border-radius: 6px; transition: all 0.2s ease;">まとめ</a>
    </div>
  </nav>

  <main style="padding: 2rem;">
    <section id="intro" style="min-height: 400px; padding: 3rem 2rem; background: #1f2a37; margin-bottom: 1rem; border-radius: 8px;">
      <h2 style="color: #e5edf4; margin-bottom: 1rem; font-size: 1.5rem;">イントロダクション</h2>
      <p style="color: #9ca3af; line-height: 1.6;">
        スムーススクロールとスクロールスパイの組み合わせにより、優れたユーザー体験を提供します。
        ナビゲーションをクリックすると、該当セクションまでスムーズにスクロールし、現在表示中のセクションがハイライトされます。
      </p>
    </section>

    <section id="features" style="min-height: 400px; padding: 3rem 2rem; background: #1f2a37; margin-bottom: 1rem; border-radius: 8px;">
      <h2 style="color: #e5edf4; margin-bottom: 1rem; font-size: 1.5rem;">特徴</h2>
      <p style="color: #9ca3af; line-height: 1.6;">
        IntersectionObserverを使用して、現在ビューポート内にあるセクションを自動検出します。
        CSSのscroll-behaviorとJavaScriptを組み合わせることで、モダンかつレガシーブラウザにも対応しています。
      </p>
    </section>

    <section id="benefits" style="min-height: 400px; padding: 3rem 2rem; background: #1f2a37; margin-bottom: 1rem; border-radius: 8px;">
      <h2 style="color: #e5edf4; margin-bottom: 1rem; font-size: 1.5rem;">メリット</h2>
      <p style="color: #9ca3af; line-height: 1.6;">
        ユーザーは現在どのセクションを閲覧しているかを一目で把握できます。
        ナビゲーションのハイライトが自動的に更新されるため、直感的な操作が可能です。
      </p>
    </section>

    <section id="conclusion" style="min-height: 400px; padding: 3rem 2rem; background: #1f2a37; border-radius: 8px;">
      <h2 style="color: #e5edf4; margin-bottom: 1rem; font-size: 1.5rem;">まとめ</h2>
      <p style="color: #9ca3af; line-height: 1.6;">
        スムーススクロールとスクロールスパイは、モダンなWebサイトには欠かせない機能です。
        シンプルな実装で、大きなUX向上を実現できます。
      </p>
    </section>
  </main>
</div>
`} css={`
html {
  scroll-behavior: smooth;
}

.nav a {
  position: relative;
}

.nav a:hover {
  color: #60a5fa !important;
  background: rgba(96, 165, 250, 0.1) !important;
}

.nav a.active {
  color: #60a5fa !important;
  background: rgba(96, 165, 250, 0.15) !important;
  font-weight: 600;
}

.nav a.active::after {
  content: '';
  position: absolute;
  bottom: -1rem;
  left: 50%;
  transform: translateX(-50%);
  width: 40px;
  height: 3px;
  background: #60a5fa;
  border-radius: 2px;
}
`} js={`
(() => {
  const links = document.querySelectorAll('.nav a[href^="#"]');
  const sections = Array.from(document.querySelectorAll('section[id]'));
  const byId = {};

  links.forEach(a => {
    const id = a.getAttribute('href').slice(1);
    byId[id] = a;
  });

  links.forEach(a => {
    a.addEventListener('click', (e) => {
      e.preventDefault();
      const id = a.getAttribute('href').slice(1);
      const target = document.getElementById(id);
      if (target) {
        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    });
  });

  const io = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        links.forEach(a => a.classList.remove('active'));
        const activeLink = byId[entry.target.id];
        if (activeLink) {
          activeLink.classList.add('active');
        }
      }
    });
  }, {
    threshold: 0.5,
    rootMargin: '-20% 0px -20% 0px'
  });

  sections.forEach(section => io.observe(section));
})();
`} />

## 実装コード

**CSS**
```css
html { scroll-behavior: smooth; }
.nav a.active { color: #60a5fa; }
```

**JS**
```js
(() => {
  document.querySelectorAll('a[href^="#"]').forEach(a => {
    a.addEventListener('click', (e) => {
      const id = a.getAttribute('href').slice(1);
      const t = document.getElementById(id);
      if (!t) return;
      // CSSのscroll-behaviorで十分。制御したい場合は下を有効化：
      // e.preventDefault(); t.scrollIntoView({ behavior: 'smooth' });
    });
  });
  const sections = Array.from(document.querySelectorAll('section[id]'));
  const navlinks = Array.from(document.querySelectorAll('.nav a[href^="#"]'));
  const byId = Object.fromEntries(navlinks.map(a => [a.getAttribute('href').slice(1), a]));
  const io = new IntersectionObserver((ents) => {
    ents.forEach(e => {
      if (e.isIntersecting) {
        navlinks.forEach(a => a.classList.remove('active'));
        const a = byId[e.target.id];
        a?.classList.add('active');
      }
    });
  }, { threshold: 0.6 });
  sections.forEach(s => io.observe(s));
})();
```