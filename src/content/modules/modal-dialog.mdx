---
title: モーダル/ダイアログ（アクセシブル）
description: オーバーレイ・フォーカストラップ・Esc閉じる・ラベル/説明対応。
tags: [modal, dialog, accessibility]
frameworks: [Vanilla, Any]
level: basic
prompt_template: |
  アクセシブルなモーダルを実装：
  - <dialog>不使用（互換性のためdiv構成）、role="dialog" aria-modal="true"
  - ラベル: aria-labelledby / 説明: aria-describedby
  - フォーカストラップ、Escで閉じる、オーバーレイクリックで閉じる
  - スクロール抑止、Reduced Motion考慮
---

import LiveDemo from '../../components/LiveDemo.astro';

<LiveDemo
  title="モーダルダイアログのデモ"
  height="400px"
  html={`
<div class="demo-container">
  <button id="open-modal" class="open-btn">モーダルを開く</button>
</div>

<div id="modal" class="modal-backdrop hidden" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-desc">
  <div class="modal-overlay"></div>
  <section class="modal-panel" role="document">
    <h2 id="modal-title">確認ダイアログ</h2>
    <p id="modal-desc">この操作を実行してもよろしいですか？Escキーまたはオーバーレイをクリックで閉じることができます。</p>
    <div class="modal-actions">
      <button id="confirm-btn" class="btn btn-primary">確認</button>
      <button id="close-modal" class="btn btn-secondary">キャンセル</button>
    </div>
  </section>
</div>
  `}
  css={`
.demo-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 200px;
}

.open-btn {
  padding: 12px 24px;
  background: #3b82f6;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  transition: background 0.2s;
}
.open-btn:hover { background: #2563eb; }

.modal-backdrop {
  position: fixed;
  inset: 0;
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
}
.modal-backdrop.hidden { display: none; }

.modal-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(2px);
}

.modal-panel {
  position: relative;
  margin: auto;
  max-width: 500px;
  width: 90%;
  background: #0c1218;
  border: 1px solid #374151;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
  transform: translateY(20px);
  opacity: 0;
  transition: transform 0.3s ease, opacity 0.3s ease;
}

.modal-backdrop:not(.hidden) .modal-panel {
  transform: translateY(0);
  opacity: 1;
}

.modal-panel h2 {
  margin: 0 0 12px 0;
  color: #e5edf4;
  font-size: 20px;
}

.modal-panel p {
  margin: 0 0 20px 0;
  color: #9ca3af;
  line-height: 1.6;
}

.modal-actions {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
}

.btn {
  padding: 8px 16px;
  border: none;
  border-radius: 6px;
  font-size: 14px;
  cursor: pointer;
  transition: background 0.2s;
}

.btn-primary {
  background: #3b82f6;
  color: white;
}
.btn-primary:hover { background: #2563eb; }

.btn-secondary {
  background: #374151;
  color: #e5edf4;
}
.btn-secondary:hover { background: #4b5563; }

@media (prefers-reduced-motion: reduce) {
  .modal-panel { transition: none; }
}
  `}
  js={`
const root = document.documentElement;
const modal = document.getElementById('modal');
const openBtn = document.getElementById('open-modal');
const closeBtn = document.getElementById('close-modal');
const confirmBtn = document.getElementById('confirm-btn');
const overlay = modal.querySelector('.modal-overlay');
let prevFocus;

const focusables = () => modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');

function open() {
  prevFocus = document.activeElement;
  modal.classList.remove('hidden');
  document.body.style.overflow = 'hidden';
  const focusableElements = Array.from(focusables());
  if (focusableElements[0]) focusableElements[0].focus();
}

function close() {
  modal.classList.add('hidden');
  document.body.style.overflow = '';
  if (prevFocus) prevFocus.focus();
}

openBtn.addEventListener('click', open);
closeBtn.addEventListener('click', close);
confirmBtn.addEventListener('click', () => {
  alert('確認しました！');
  close();
});
overlay.addEventListener('click', close);

document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
    close();
  }

  // Focus trap
  if (e.key === 'Tab' && !modal.classList.contains('hidden')) {
    const nodes = Array.from(focusables());
    const first = nodes[0];
    const last = nodes[nodes.length - 1];

    if (e.shiftKey && document.activeElement === first) {
      last.focus();
      e.preventDefault();
    } else if (!e.shiftKey && document.activeElement === last) {
      first.focus();
      e.preventDefault();
    }
  }
});
  `}
/>

## 実装コード

**HTML**
```html
<button id="open-modal">Open</button>

<div id="modal" class="hidden" role="dialog" aria-modal="true" aria-labelledby="m-title" aria-describedby="m-desc">
  <div class="overlay"></div>
  <section class="panel" role="document">
    <h2 id="m-title">タイトル</h2>
    <p id="m-desc">説明文。Tab移動はパネル内に閉じ込め。</p>
    <button id="close-modal">閉じる</button>
  </section>
</div>
```

**CSS**
```css
.hidden { display: none; }
#modal { position: fixed; inset: 0; }
#modal .overlay { position: absolute; inset:0; background: rgba(0,0,0,.5); }
#modal .panel {
  position: relative; margin: 10vh auto; max-width: 560px; background:#0c1218; border:1px solid #1f2a37; padding: 1rem; border-radius: 12px;
  transform: translateY(10px); opacity: 0; transition: transform .2s ease, opacity .2s;
}
[data-modal-open="true"] #modal { display:block; }
@media (prefers-reduced-motion: reduce) { #modal .panel { transition: none; } }
[data-modal-open="true"] #modal .panel { transform: none; opacity: 1; }
```

**JS**
```js
(() => {
  const root = document.documentElement;
  const modal = document.getElementById('modal');
  const openBtn = document.getElementById('open-modal');
  const closeBtn = document.getElementById('close-modal');
  const overlay = modal?.querySelector('.overlay');
  let prevFocus;
  const focusables = () => modal.querySelectorAll('a,button,input,textarea,select,[tabindex]:not([tabindex="-1"])');
  function open() {
    prevFocus = document.activeElement;
    root.setAttribute('data-modal-open', 'true');
    document.body.style.overflow = 'hidden';
    focusables()[0]?.focus();
  }
  function close() {
    root.removeAttribute('data-modal-open');
    document.body.style.overflow = '';
    prevFocus?.focus();
  }
  openBtn?.addEventListener('click', open);
  closeBtn?.addEventListener('click', close);
  overlay?.addEventListener('click', close);
  document.addEventListener('keydown', (e)=>{
    if (e.key === 'Escape') close();
    if (e.key === 'Tab' && root.getAttribute('data-modal-open') === 'true') {
      const nodes = Array.from(focusables());
      const first = nodes[0], last = nodes[nodes.length-1];
      if (e.shiftKey && document.activeElement === first) { last.focus(); e.preventDefault(); }
      else if (!e.shiftKey && document.activeElement === last) { first.focus(); e.preventDefault(); }
    }
  });
})();
```