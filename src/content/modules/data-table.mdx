---
title: データテーブル（ソート/フィルタ/ページング/選択）
description: プロダクション対応の高機能データテーブル。ソート、フィルタ、ページネーション、行選択、レスポンシブ対応。
tags: [data, table, sorting, filtering, pagination, performance]
frameworks: [Vanilla, Any]
level: advanced
prompt_template: |
  プロダクション品質のデータテーブルを実装。要件：
  - カラムヘッダークリックでソート（昇順/降順/元の順）
  - 各カラムにテキストフィルタ入力（リアルタイム検索）
  - ページネーション（10/25/50/100件/ページ、前後ページ、ページジャンプ）
  - 行選択（個別チェックボックス、全選択/全解除）
  - レスポンシブ：モバイルではカード表示、デスクトップでテーブル
  - キーボードナビゲーション（矢印キー、Space/Enterで選択）
  - ARIA対応（role="grid", aria-sort, aria-selected）
  - データ型対応（text, number, date, status）
  - 選択数表示とバルクアクション UI
  - パフォーマンス最適化（仮想DOM不使用で50+行を滑らか表示）
---

import LiveDemo from '../../components/LiveDemo.astro';

<LiveDemo
  title="データテーブルのデモ（50件のサンプルデータ）"
  height="700px"
  html={`
<div class="data-table-container">
  <!-- Toolbar -->
  <div class="table-toolbar">
    <div class="toolbar-left">
      <div class="selected-count" style="display: none;">
        <span class="count">0</span> 件選択中
        <button class="btn-clear-selection">選択解除</button>
      </div>
      <div class="bulk-actions" style="display: none;">
        <button class="btn-bulk">一括削除</button>
        <button class="btn-bulk">一括エクスポート</button>
      </div>
    </div>
    <div class="toolbar-right">
      <select class="page-size-selector" aria-label="表示件数">
        <option value="10">10件/ページ</option>
        <option value="25" selected>25件/ページ</option>
        <option value="50">50件/ページ</option>
        <option value="100">100件/ページ</option>
      </select>
    </div>
  </div>

  <!-- Table wrapper -->
  <div class="table-wrapper">
    <table class="data-table" role="grid" aria-label="ユーザーデータテーブル">
      <thead>
        <tr>
          <th class="col-select">
            <input type="checkbox" class="select-all" aria-label="全て選択">
          </th>
          <th class="sortable" data-column="id" data-type="number">
            <div class="th-content">
              <span>ID</span>
              <span class="sort-icon">⇅</span>
            </div>
            <input type="text" class="column-filter" placeholder="フィルタ..." aria-label="IDでフィルタ">
          </th>
          <th class="sortable" data-column="name" data-type="text">
            <div class="th-content">
              <span>名前</span>
              <span class="sort-icon">⇅</span>
            </div>
            <input type="text" class="column-filter" placeholder="フィルタ..." aria-label="名前でフィルタ">
          </th>
          <th class="sortable" data-column="email" data-type="text">
            <div class="th-content">
              <span>メールアドレス</span>
              <span class="sort-icon">⇅</span>
            </div>
            <input type="text" class="column-filter" placeholder="フィルタ..." aria-label="メールでフィルタ">
          </th>
          <th class="sortable" data-column="role" data-type="text">
            <div class="th-content">
              <span>役割</span>
              <span class="sort-icon">⇅</span>
            </div>
            <input type="text" class="column-filter" placeholder="フィルタ..." aria-label="役割でフィルタ">
          </th>
          <th class="sortable" data-column="status" data-type="text">
            <div class="th-content">
              <span>ステータス</span>
              <span class="sort-icon">⇅</span>
            </div>
            <input type="text" class="column-filter" placeholder="フィルタ..." aria-label="ステータスでフィルタ">
          </th>
          <th class="sortable" data-column="joinDate" data-type="date">
            <div class="th-content">
              <span>登録日</span>
              <span class="sort-icon">⇅</span>
            </div>
            <input type="text" class="column-filter" placeholder="フィルタ..." aria-label="登録日でフィルタ">
          </th>
        </tr>
      </thead>
      <tbody class="table-body">
        <!-- Rows will be injected here -->
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="pagination">
    <div class="pagination-info">
      <span class="showing-text"></span>
    </div>
    <div class="pagination-controls">
      <button class="page-btn page-first" aria-label="最初のページ">«</button>
      <button class="page-btn page-prev" aria-label="前のページ">‹</button>
      <div class="page-numbers"></div>
      <button class="page-btn page-next" aria-label="次のページ">›</button>
      <button class="page-btn page-last" aria-label="最後のページ">»</button>
    </div>
  </div>
</div>
  `}
  css={`
.data-table-container {
  width: 100%;
  background: #0c1218;
  border-radius: 12px;
  overflow: hidden;
  border: 1px solid #1f2a37;
}

/* Toolbar */
.table-toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  background: #1f2a37;
  border-bottom: 1px solid #374151;
  gap: 12px;
  flex-wrap: wrap;
}

.toolbar-left {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
}

.selected-count {
  display: flex;
  align-items: center;
  gap: 8px;
  color: #e5edf4;
  font-size: 14px;
  font-weight: 600;
}

.selected-count .count {
  color: #60a5fa;
}

.btn-clear-selection {
  padding: 4px 12px;
  background: #374151;
  border: 1px solid #4b5563;
  border-radius: 6px;
  color: #e5edf4;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-clear-selection:hover {
  background: #4b5563;
}

.bulk-actions {
  display: flex;
  gap: 8px;
}

.btn-bulk {
  padding: 6px 12px;
  background: #1e40af;
  border: 1px solid #2563eb;
  border-radius: 6px;
  color: #e5edf4;
  font-size: 13px;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-bulk:hover {
  background: #2563eb;
}

.page-size-selector {
  padding: 6px 12px;
  background: #0c1218;
  border: 1px solid #374151;
  border-radius: 6px;
  color: #e5edf4;
  font-size: 14px;
  cursor: pointer;
}

/* Table */
.table-wrapper {
  overflow-x: auto;
  max-height: 450px;
  overflow-y: auto;
}

.data-table {
  width: 100%;
  border-collapse: collapse;
  color: #e5edf4;
}

.data-table thead {
  position: sticky;
  top: 0;
  z-index: 10;
  background: #1f2a37;
}

.data-table th {
  padding: 12px;
  text-align: left;
  font-weight: 600;
  font-size: 13px;
  border-bottom: 2px solid #374151;
  background: #1f2a37;
}

.data-table th.sortable {
  cursor: pointer;
  user-select: none;
}

.th-content {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
}

.sort-icon {
  font-size: 12px;
  color: #6b7280;
  transition: color 0.2s;
}

.sortable:hover .sort-icon {
  color: #60a5fa;
}

.sortable[aria-sort="ascending"] .sort-icon::before {
  content: '↑';
  color: #60a5fa;
}

.sortable[aria-sort="descending"] .sort-icon::before {
  content: '↓';
  color: #60a5fa;
}

.sortable[aria-sort="ascending"] .sort-icon,
.sortable[aria-sort="descending"] .sort-icon {
  color: transparent;
}

.column-filter {
  width: 100%;
  padding: 6px 8px;
  background: #0c1218;
  border: 1px solid #374151;
  border-radius: 4px;
  color: #e5edf4;
  font-size: 12px;
  transition: border-color 0.2s;
}

.column-filter:focus {
  outline: none;
  border-color: #60a5fa;
}

.column-filter::placeholder {
  color: #6b7280;
}

.col-select {
  width: 50px;
  text-align: center;
}

.data-table tbody tr {
  border-bottom: 1px solid #1f2a37;
  transition: background 0.2s;
}

.data-table tbody tr:hover {
  background: #1a2332;
}

.data-table tbody tr[aria-selected="true"] {
  background: #1e3a5f;
}

.data-table tbody tr:focus-visible {
  outline: 2px solid #60a5fa;
  outline-offset: -2px;
}

.data-table td {
  padding: 12px;
  font-size: 14px;
}

.data-table td input[type="checkbox"] {
  cursor: pointer;
}

.status-badge {
  display: inline-block;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 600;
}

.status-active {
  background: #065f46;
  color: #6ee7b7;
}

.status-inactive {
  background: #7c2d12;
  color: #fca5a5;
}

.status-pending {
  background: #78350f;
  color: #fcd34d;
}

/* Pagination */
.pagination {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  background: #1f2a37;
  border-top: 1px solid #374151;
  gap: 12px;
  flex-wrap: wrap;
}

.pagination-info {
  color: #9ca3af;
  font-size: 14px;
}

.pagination-controls {
  display: flex;
  align-items: center;
  gap: 4px;
}

.page-btn {
  padding: 6px 10px;
  background: #0c1218;
  border: 1px solid #374151;
  border-radius: 6px;
  color: #e5edf4;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s;
  min-width: 36px;
}

.page-btn:hover:not(:disabled) {
  background: #374151;
  border-color: #60a5fa;
}

.page-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.page-numbers {
  display: flex;
  gap: 4px;
}

.page-btn.active {
  background: #1e40af;
  border-color: #2563eb;
  color: white;
  font-weight: 600;
}

/* Responsive: Mobile Cards */
@media (max-width: 768px) {
  .table-wrapper {
    max-height: none;
  }

  .data-table thead {
    display: none;
  }

  .data-table tbody {
    display: block;
  }

  .data-table tbody tr {
    display: block;
    margin-bottom: 12px;
    border-radius: 8px;
    border: 1px solid #374151;
    padding: 12px;
  }

  .data-table tbody tr[aria-selected="true"] {
    border-color: #60a5fa;
  }

  .data-table td {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid #1f2a37;
  }

  .data-table td:last-child {
    border-bottom: none;
  }

  .data-table td::before {
    content: attr(data-label);
    font-weight: 600;
    color: #9ca3af;
    font-size: 12px;
  }

  .data-table td:first-child {
    border-bottom: 2px solid #374151;
    margin-bottom: 8px;
    padding-bottom: 12px;
  }
}
  `}
  js={`
// Sample data generator
function generateSampleData(count) {
  const names = ['田中太郎', '佐藤花子', '鈴木一郎', '高橋美咲', '伊藤健太', '渡辺さくら', '山本大輔', '中村由美', '小林隆', '加藤愛'];
  const roles = ['管理者', 'エディター', 'ビューワー', '開発者', 'デザイナー'];
  const statuses = ['active', 'inactive', 'pending'];
  const statusLabels = { active: 'アクティブ', inactive: '非アクティブ', pending: '保留中' };

  return Array.from({ length: count }, (_, i) => {
    const id = i + 1;
    const name = names[Math.floor(Math.random() * names.length)] + id;
    const role = roles[Math.floor(Math.random() * roles.length)];
    const status = statuses[Math.floor(Math.random() * statuses.length)];
    const joinDate = new Date(2020 + Math.floor(Math.random() * 5), Math.floor(Math.random() * 12), Math.floor(Math.random() * 28) + 1);

    return {
      id,
      name,
      email: \`user\${id}@example.com\`,
      role,
      status,
      statusLabel: statusLabels[status],
      joinDate: joinDate.toISOString().split('T')[0]
    };
  });
}

// DataTable class
class DataTable {
  constructor(container) {
    this.container = container;
    this.data = generateSampleData(50);
    this.filteredData = [...this.data];
    this.sortColumn = null;
    this.sortDirection = null; // null, 'asc', 'desc'
    this.filters = {};
    this.currentPage = 1;
    this.pageSize = 25;
    this.selectedRows = new Set();

    this.tbody = container.querySelector('.table-body');
    this.selectAllCheckbox = container.querySelector('.select-all');
    this.pageSizeSelector = container.querySelector('.page-size-selector');
    this.selectedCount = container.querySelector('.selected-count');
    this.countSpan = container.querySelector('.selected-count .count');
    this.bulkActions = container.querySelector('.bulk-actions');
    this.paginationInfo = container.querySelector('.showing-text');
    this.pageNumbers = container.querySelector('.page-numbers');

    this.init();
  }

  init() {
    this.bindEvents();
    this.render();
  }

  bindEvents() {
    // Sort headers
    this.container.querySelectorAll('.sortable').forEach(th => {
      th.addEventListener('click', (e) => {
        if (e.target.classList.contains('column-filter')) return;
        this.handleSort(th.dataset.column, th.dataset.type);
      });
    });

    // Column filters
    this.container.querySelectorAll('.column-filter').forEach(input => {
      input.addEventListener('input', (e) => {
        const column = e.target.closest('th').dataset.column;
        this.handleFilter(column, e.target.value);
      });
    });

    // Select all
    this.selectAllCheckbox.addEventListener('change', (e) => {
      this.handleSelectAll(e.target.checked);
    });

    // Page size
    this.pageSizeSelector.addEventListener('change', (e) => {
      this.pageSize = parseInt(e.target.value);
      this.currentPage = 1;
      this.render();
    });

    // Pagination buttons
    this.container.querySelector('.page-first').addEventListener('click', () => this.goToPage(1));
    this.container.querySelector('.page-prev').addEventListener('click', () => this.goToPage(this.currentPage - 1));
    this.container.querySelector('.page-next').addEventListener('click', () => this.goToPage(this.currentPage + 1));
    this.container.querySelector('.page-last').addEventListener('click', () => this.goToPage(this.getTotalPages()));

    // Clear selection
    this.container.querySelector('.btn-clear-selection').addEventListener('click', () => {
      this.selectedRows.clear();
      this.render();
    });

    // Keyboard navigation
    this.tbody.addEventListener('keydown', (e) => {
      this.handleKeyboard(e);
    });
  }

  handleSort(column, type) {
    if (this.sortColumn === column) {
      if (this.sortDirection === 'asc') {
        this.sortDirection = 'desc';
      } else if (this.sortDirection === 'desc') {
        this.sortColumn = null;
        this.sortDirection = null;
      } else {
        this.sortDirection = 'asc';
      }
    } else {
      this.sortColumn = column;
      this.sortDirection = 'asc';
    }

    this.applyFiltersAndSort();
    this.currentPage = 1;
    this.render();
  }

  handleFilter(column, value) {
    if (value.trim() === '') {
      delete this.filters[column];
    } else {
      this.filters[column] = value.toLowerCase();
    }

    this.applyFiltersAndSort();
    this.currentPage = 1;
    this.render();
  }

  applyFiltersAndSort() {
    // Apply filters
    this.filteredData = this.data.filter(row => {
      return Object.entries(this.filters).every(([column, filterValue]) => {
        const cellValue = String(row[column]).toLowerCase();
        return cellValue.includes(filterValue);
      });
    });

    // Apply sort
    if (this.sortColumn && this.sortDirection) {
      const column = this.sortColumn;
      const direction = this.sortDirection;
      const type = this.container.querySelector(\`[data-column="\${column}"]\`).dataset.type;

      this.filteredData.sort((a, b) => {
        let valA = a[column];
        let valB = b[column];

        if (type === 'number') {
          valA = parseFloat(valA) || 0;
          valB = parseFloat(valB) || 0;
        } else if (type === 'date') {
          valA = new Date(valA).getTime();
          valB = new Date(valB).getTime();
        } else {
          valA = String(valA).toLowerCase();
          valB = String(valB).toLowerCase();
        }

        if (valA < valB) return direction === 'asc' ? -1 : 1;
        if (valA > valB) return direction === 'asc' ? 1 : -1;
        return 0;
      });
    }
  }

  handleSelectAll(checked) {
    const currentPageData = this.getCurrentPageData();
    if (checked) {
      currentPageData.forEach(row => this.selectedRows.add(row.id));
    } else {
      currentPageData.forEach(row => this.selectedRows.delete(row.id));
    }
    this.render();
  }

  handleRowSelect(id, checked) {
    if (checked) {
      this.selectedRows.add(id);
    } else {
      this.selectedRows.delete(id);
    }
    this.render();
  }

  handleKeyboard(e) {
    const focusedRow = this.tbody.querySelector('tr:focus');
    if (!focusedRow) return;

    const rows = Array.from(this.tbody.querySelectorAll('tr'));
    const currentIndex = rows.indexOf(focusedRow);

    if (e.key === 'ArrowDown') {
      e.preventDefault();
      if (currentIndex < rows.length - 1) {
        rows[currentIndex + 1].focus();
      }
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      if (currentIndex > 0) {
        rows[currentIndex - 1].focus();
      }
    } else if (e.key === ' ' || e.key === 'Enter') {
      e.preventDefault();
      const checkbox = focusedRow.querySelector('input[type="checkbox"]');
      checkbox.checked = !checkbox.checked;
      const id = parseInt(focusedRow.dataset.id);
      this.handleRowSelect(id, checkbox.checked);
    }
  }

  getTotalPages() {
    return Math.ceil(this.filteredData.length / this.pageSize);
  }

  getCurrentPageData() {
    const start = (this.currentPage - 1) * this.pageSize;
    const end = start + this.pageSize;
    return this.filteredData.slice(start, end);
  }

  goToPage(page) {
    const totalPages = this.getTotalPages();
    if (page < 1 || page > totalPages) return;
    this.currentPage = page;
    this.render();
  }

  render() {
    this.renderTable();
    this.renderPagination();
    this.renderSelection();
    this.updateSortIcons();
  }

  renderTable() {
    const pageData = this.getCurrentPageData();

    this.tbody.innerHTML = pageData.map(row => \`
      <tr data-id="\${row.id}" tabindex="0" aria-selected="\${this.selectedRows.has(row.id)}">
        <td data-label="選択" class="col-select">
          <input type="checkbox" \${this.selectedRows.has(row.id) ? 'checked' : ''}
            onchange="window.dataTableInstance.handleRowSelect(\${row.id}, this.checked)">
        </td>
        <td data-label="ID">\${row.id}</td>
        <td data-label="名前">\${row.name}</td>
        <td data-label="メールアドレス">\${row.email}</td>
        <td data-label="役割">\${row.role}</td>
        <td data-label="ステータス">
          <span class="status-badge status-\${row.status}">\${row.statusLabel}</span>
        </td>
        <td data-label="登録日">\${row.joinDate}</td>
      </tr>
    \`).join('');
  }

  renderPagination() {
    const totalPages = this.getTotalPages();
    const start = (this.currentPage - 1) * this.pageSize + 1;
    const end = Math.min(this.currentPage * this.pageSize, this.filteredData.length);

    this.paginationInfo.textContent = \`\${start}〜\${end}件を表示（全\${this.filteredData.length}件）\`;

    // Page buttons
    this.container.querySelector('.page-first').disabled = this.currentPage === 1;
    this.container.querySelector('.page-prev').disabled = this.currentPage === 1;
    this.container.querySelector('.page-next').disabled = this.currentPage === totalPages;
    this.container.querySelector('.page-last').disabled = this.currentPage === totalPages;

    // Page numbers
    const maxButtons = 5;
    let startPage = Math.max(1, this.currentPage - Math.floor(maxButtons / 2));
    let endPage = Math.min(totalPages, startPage + maxButtons - 1);

    if (endPage - startPage < maxButtons - 1) {
      startPage = Math.max(1, endPage - maxButtons + 1);
    }

    this.pageNumbers.innerHTML = '';
    for (let i = startPage; i <= endPage; i++) {
      const btn = document.createElement('button');
      btn.className = 'page-btn' + (i === this.currentPage ? ' active' : '');
      btn.textContent = i;
      btn.onclick = () => this.goToPage(i);
      this.pageNumbers.appendChild(btn);
    }
  }

  renderSelection() {
    const count = this.selectedRows.size;

    if (count > 0) {
      this.selectedCount.style.display = 'flex';
      this.bulkActions.style.display = 'flex';
      this.countSpan.textContent = count;
    } else {
      this.selectedCount.style.display = 'none';
      this.bulkActions.style.display = 'none';
    }

    // Update select all checkbox
    const currentPageData = this.getCurrentPageData();
    const allSelected = currentPageData.length > 0 &&
      currentPageData.every(row => this.selectedRows.has(row.id));
    const someSelected = currentPageData.some(row => this.selectedRows.has(row.id));

    this.selectAllCheckbox.checked = allSelected;
    this.selectAllCheckbox.indeterminate = someSelected && !allSelected;
  }

  updateSortIcons() {
    this.container.querySelectorAll('.sortable').forEach(th => {
      if (th.dataset.column === this.sortColumn) {
        th.setAttribute('aria-sort', this.sortDirection);
      } else {
        th.removeAttribute('aria-sort');
      }
    });
  }
}

// Initialize
const container = document.querySelector('.data-table-container');
const dataTable = new DataTable(container);
window.dataTableInstance = dataTable; // For inline event handlers
  `}
/>

## 概要

本格的なプロダクション環境で使用できる高機能データテーブルコンポーネントです。大量のデータを効率的に表示・操作するための主要機能を全て実装しています。50件以上のサンプルデータで、ソート、フィルタリング、ページネーション、行選択などの実践的な機能を体験できます。

レスポンシブデザインにより、デスクトップではテーブル形式、モバイルではカード形式で表示され、あらゆるデバイスで快適に操作できます。キーボードナビゲーションとARIAラベルによるアクセシビリティ対応も万全で、スクリーンリーダーユーザーやキーボード操作を好むユーザーにも配慮しています。

## 主要機能

### データ操作
- **カラムソート**: ヘッダークリックで昇順→降順→元の順の3段階切り替え
- **カラムフィルタ**: 各列に独立したテキストフィルタ（リアルタイム検索）
- **ページネーション**: 10/25/50/100件から選択可能、ページジャンプ対応
- **行選択**: 個別チェックボックス、全選択、一括操作UI

### ユーザビリティ
- **キーボード操作**: 矢印キーで行移動、Space/Enterで選択
- **レスポンシブ**: モバイルは自動でカード表示に切り替え
- **アクセシビリティ**: ARIA属性完備（role="grid", aria-sort, aria-selected）
- **パフォーマンス**: 50+行でもスムーズな操作感

## パフォーマンス特性

### 最適化ポイント
1. **効率的なレンダリング**: ページング時は表示範囲のDOMのみ生成
2. **インプレイスソート**: ネイティブArray.sortで高速処理
3. **デバウンス不要**: フィルタはシンプルな文字列マッチングで即応答
4. **メモリ効率**: 選択状態はSetで管理（O(1)検索）

### スケーラビリティ
- **推奨データ量**: 〜1,000行（ページング前提）
- **最大実用**: 〜10,000行（フィルタ/ソート時に若干のラグ）
- **超大規模**: 10,000行以上は仮想スクロール（virtual-list.mdx）推奨

## 実装コード

完全なプロダクション対応の実装です。そのままプロジェクトに組み込んで使用できます。

### HTML構造

```html
<div class="data-table-container">
  <!-- ツールバー -->
  <div class="table-toolbar">
    <div class="toolbar-left">
      <div class="selected-count" style="display: none;">
        <span class="count">0</span> 件選択中
        <button class="btn-clear-selection">選択解除</button>
      </div>
      <div class="bulk-actions" style="display: none;">
        <button class="btn-bulk">一括削除</button>
      </div>
    </div>
    <div class="toolbar-right">
      <select class="page-size-selector">
        <option value="25" selected>25件/ページ</option>
      </select>
    </div>
  </div>

  <!-- テーブル -->
  <div class="table-wrapper">
    <table class="data-table" role="grid">
      <thead>
        <tr>
          <th class="col-select">
            <input type="checkbox" class="select-all">
          </th>
          <th class="sortable" data-column="name" data-type="text">
            <div class="th-content">
              <span>名前</span>
              <span class="sort-icon">⇅</span>
            </div>
            <input type="text" class="column-filter" placeholder="フィルタ...">
          </th>
          <!-- 他のカラム... -->
        </tr>
      </thead>
      <tbody class="table-body"></tbody>
    </table>
  </div>

  <!-- ページネーション -->
  <div class="pagination">
    <div class="pagination-info"></div>
    <div class="pagination-controls">
      <button class="page-btn page-first">«</button>
      <button class="page-btn page-prev">‹</button>
      <div class="page-numbers"></div>
      <button class="page-btn page-next">›</button>
      <button class="page-btn page-last">»</button>
    </div>
  </div>
</div>
```

### JavaScript実装

```javascript
class DataTable {
  constructor(container) {
    this.data = []; // 元データ
    this.filteredData = []; // フィルタ後
    this.sortColumn = null;
    this.sortDirection = null;
    this.filters = {};
    this.currentPage = 1;
    this.pageSize = 25;
    this.selectedRows = new Set();
    this.init();
  }

  handleSort(column, type) {
    // 3段階ソート: null → asc → desc → null
    if (this.sortColumn === column) {
      if (this.sortDirection === 'asc') {
        this.sortDirection = 'desc';
      } else if (this.sortDirection === 'desc') {
        this.sortColumn = null;
        this.sortDirection = null;
      }
    } else {
      this.sortColumn = column;
      this.sortDirection = 'asc';
    }
    this.applyFiltersAndSort();
    this.render();
  }

  handleFilter(column, value) {
    if (value.trim() === '') {
      delete this.filters[column];
    } else {
      this.filters[column] = value.toLowerCase();
    }
    this.applyFiltersAndSort();
    this.currentPage = 1;
    this.render();
  }

  applyFiltersAndSort() {
    // フィルタリング
    this.filteredData = this.data.filter(row => {
      return Object.entries(this.filters).every(([col, val]) => {
        return String(row[col]).toLowerCase().includes(val);
      });
    });

    // ソート
    if (this.sortColumn && this.sortDirection) {
      this.filteredData.sort((a, b) => {
        let valA = a[this.sortColumn];
        let valB = b[this.sortColumn];
        // 型に応じた比較...
      });
    }
  }

  render() {
    const start = (this.currentPage - 1) * this.pageSize;
    const pageData = this.filteredData.slice(start, start + this.pageSize);

    this.tbody.innerHTML = pageData.map(row => \`
      <tr data-id="\${row.id}" tabindex="0">
        <td><input type="checkbox"></td>
        <td>\${row.name}</td>
        <!-- 他のセル... -->
      </tr>
    \`).join('');
  }
}
```

## アクセシビリティ考慮事項

### ARIA属性
- **role="grid"**: テーブルがグリッドであることを示す
- **aria-sort**: ソート状態（ascending/descending/none）
- **aria-selected**: 行の選択状態
- **aria-label**: ボタンやコントロールの説明

### キーボードナビゲーション
- **矢印キー上下**: 行間の移動
- **Space/Enter**: 行の選択/選択解除
- **Tab**: フォーカス可能な要素間の移動
- **フォーカス表示**: focus-visibleで明確な視覚フィードバック

## パフォーマンス最適化のヒント

### 大規模データ対応
1. **バックエンドページング**: 1,000行以上はサーバーサイドでページング
2. **遅延ロード**: 初期表示は最小限、スクロール/ページ変更時にロード
3. **仮想スクロール**: 10,000行以上は仮想スクロールリスト（virtual-list.mdx）を使用

### レンダリング最適化
1. **innerHTML一括生成**: ループ内でDOM操作しない
2. **DocumentFragment**: 複雑な構造は一時フラグメントで構築
3. **CSS containment**: contain: layout style paintで描画範囲を最適化

### メモリ管理
1. **Set/Map活用**: 選択状態やインデックスはSetで高速検索
2. **イベント委譲**: 行ごとにリスナー不要、親で一括処理
3. **WeakMap検討**: DOM要素とデータの紐付けに使用可能

## よくある落とし穴と解決策

### 問題1: フィルタ時にページ番号が不正
**解決**: フィルタ変更時は必ず`currentPage = 1`にリセット

### 問題2: 選択状態が消える
**解決**: 選択はデータIDで管理、レンダリングで復元

### 問題3: モバイルでテーブルが見づらい
**解決**: メディアクエリでカード表示に切り替え、`data-label`属性でラベル表示

### 問題4: ソートが遅い
**解決**: データ型を正しく指定（data-type="number|date|text"）、適切な比較関数使用

### 問題5: アクセシビリティエラー
**解決**: 全ての対話要素にaria-labelを付与、キーボード操作をサポート
