---
title: Magic Linkèªè¨¼å®Ÿè£…
description: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ¬ã‚¹èªè¨¼ã‚’å®Ÿç¾ã™ã‚‹Magic Linkï¼ˆãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯ï¼‰ã®å®Œå…¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰ã€‚ã‚»ã‚­ãƒ¥ã‚¢ãªãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆã‹ã‚‰ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã¾ã§ã€‚
tags: [integration, auth, authentication, magic-link, passwordless, security]
service: Email Service (SendGrid/Resend)
level: intermediate
env_vars: [JWT_SECRET, EMAIL_API_KEY, EMAIL_FROM, APP_URL, MAGIC_LINK_TTL]
dependencies: [jsonwebtoken, nodemailer, resend, bcryptjs]
prompt_template: |
  Create a Magic Link authentication system with:
  - Email input form for passwordless login
  - Secure token generation (JWT or crypto)
  - Email sending with magic link
  - Token verification on callback
  - Session/JWT management after login
  - Security best practices (token expiry, one-time use, CSRF protection)
  - Email template with HTML styling
---

import LiveDemo from '../../components/LiveDemo.astro';

## Magic Linkèªè¨¼ã®æ¦‚è¦

Magic Linkï¼ˆãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯ï¼‰ã¯ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ã‚ãšã«ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã ã‘ã§ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹èªè¨¼æ–¹å¼ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ã‚»ã‚­ãƒ¥ã‚¢ãªãƒªãƒ³ã‚¯ãŒé€ä¿¡ã•ã‚Œã€ãã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã ã‘ã§ãƒ­ã‚°ã‚¤ãƒ³ãŒå®Œäº†ã—ã¾ã™ã€‚

**ãƒ¡ãƒªãƒƒãƒˆ:**
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†ä¸è¦ï¼ˆæ¼æ´©ãƒªã‚¹ã‚¯ãªã—ï¼‰
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ãŒä¸è¦
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å‘ä¸Š
- å®Ÿè£…ãŒã‚·ãƒ³ãƒ—ãƒ«

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶:**
- ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ï¼ˆ15åˆ†æ¨å¥¨ï¼‰
- ãƒ¯ãƒ³ã‚¿ã‚¤ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆä¸€åº¦ä½¿ç”¨ã—ãŸã‚‰ç„¡åŠ¹åŒ–ï¼‰
- CSRFå¯¾ç­–
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™

<LiveDemo
  title="Magic Linkèªè¨¼ãƒ‡ãƒ¢ - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ¬ã‚¹ãƒ­ã‚°ã‚¤ãƒ³"
  height="600px"
  html={`
<div class="auth-container">
  <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ  -->
  <div class="login-card" id="loginCard">
    <div class="logo">ğŸ”</div>
    <h1 class="title">Magic Linkã§ãƒ­ã‚°ã‚¤ãƒ³</h1>
    <p class="subtitle">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸è¦ã€‚ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã ã‘ã§ãƒ­ã‚°ã‚¤ãƒ³ã§ãã¾ã™ã€‚</p>

    <form class="login-form" id="loginForm">
      <div class="form-group">
        <label for="email" class="label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
        <input
          type="email"
          id="email"
          class="input"
          placeholder="your@email.com"
          required
        />
      </div>

      <button type="submit" class="submit-btn" id="submitBtn">
        <span class="btn-icon">âœ‰ï¸</span>
        <span class="btn-text">Magic Linkã‚’é€ä¿¡</span>
      </button>
    </form>

    <div class="info-box">
      <span class="info-icon">â„¹ï¸</span>
      <p>
        ã‚»ã‚­ãƒ¥ã‚¢ãªãƒªãƒ³ã‚¯ã‚’ãƒ¡ãƒ¼ãƒ«ã§é€ä¿¡ã—ã¾ã™ã€‚ãƒªãƒ³ã‚¯ã®æœ‰åŠ¹æœŸé™ã¯<strong>15åˆ†é–“</strong>ã§ã™ã€‚
      </p>
    </div>

    <div class="features">
      <div class="feature-item">
        <span class="feature-icon">ğŸ”’</span>
        <span class="feature-text">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸è¦</span>
      </div>
      <div class="feature-item">
        <span class="feature-icon">âš¡</span>
        <span class="feature-text">ç´ æ—©ããƒ­ã‚°ã‚¤ãƒ³</span>
      </div>
      <div class="feature-item">
        <span class="feature-icon">ğŸ›¡ï¸</span>
        <span class="feature-text">å®‰å…¨ãªèªè¨¼</span>
      </div>
    </div>
  </div>

  <!-- ãƒ¡ãƒ¼ãƒ«é€ä¿¡å®Œäº†ç”»é¢ -->
  <div class="email-sent-card" id="emailSentCard" style="display: none;">
    <div class="checkmark-wrapper">
      <div class="checkmark">âœ“</div>
    </div>
    <h2 class="success-title">ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼</h2>
    <p class="success-message">
      <strong id="sentEmail"></strong> ã«Magic Linkã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚
    </p>

    <div class="email-preview">
      <div class="email-header">
        <div class="email-from">
          <strong>From:</strong> noreply@yourapp.com
        </div>
        <div class="email-subject">
          <strong>Subject:</strong> ãƒ­ã‚°ã‚¤ãƒ³ãƒªãƒ³ã‚¯
        </div>
      </div>
      <div class="email-body">
        <p>ã“ã‚“ã«ã¡ã¯ï¼</p>
        <p>ä»¥ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ï¼š</p>
        <button class="magic-link-btn" id="magicLinkBtn">
          ğŸ” ãƒ­ã‚°ã‚¤ãƒ³
        </button>
        <p class="email-note">ã“ã®ãƒªãƒ³ã‚¯ã¯15åˆ†é–“æœ‰åŠ¹ã§ã™ã€‚</p>
      </div>
    </div>

    <div class="instructions">
      <p>ğŸ“§ ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„</p>
      <p class="small-text">ãƒ¡ãƒ¼ãƒ«ãŒå±Šã‹ãªã„å ´åˆã¯ã€è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«ãƒ•ã‚©ãƒ«ãƒ€ã‚‚ã”ç¢ºèªãã ã•ã„ã€‚</p>
    </div>

    <button class="back-btn" id="backBtn">åˆ¥ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è©¦ã™</button>
  </div>

  <!-- èªè¨¼ä¸­ç”»é¢ -->
  <div class="verifying-card" id="verifyingCard" style="display: none;">
    <div class="spinner"></div>
    <h2 class="verifying-title">èªè¨¼ä¸­...</h2>
    <p class="verifying-message">Magic Linkã‚’æ¤œè¨¼ã—ã¦ã„ã¾ã™ã€‚å°‘ã€…ãŠå¾…ã¡ãã ã•ã„ã€‚</p>
  </div>

  <!-- ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸç”»é¢ -->
  <div class="success-card" id="successCard" style="display: none;">
    <div class="welcome-icon">ğŸ‘‹</div>
    <h2 class="welcome-title">ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼</h2>
    <p class="welcome-message">
      ã‚ˆã†ã“ãã€<strong id="loggedInEmail"></strong>ã•ã‚“
    </p>

    <div class="user-dashboard">
      <div class="dashboard-item">
        <div class="dashboard-icon">ğŸ‘¤</div>
        <div class="dashboard-content">
          <div class="dashboard-label">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID</div>
          <div class="dashboard-value" id="userId">user_1234567890</div>
        </div>
      </div>

      <div class="dashboard-item">
        <div class="dashboard-icon">ğŸ•’</div>
        <div class="dashboard-content">
          <div class="dashboard-label">ãƒ­ã‚°ã‚¤ãƒ³æ™‚åˆ»</div>
          <div class="dashboard-value" id="loginTime"></div>
        </div>
      </div>

      <div class="dashboard-item">
        <div class="dashboard-icon">ğŸ”‘</div>
        <div class="dashboard-content">
          <div class="dashboard-label">ã‚»ãƒƒã‚·ãƒ§ãƒ³</div>
          <div class="dashboard-value">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</div>
        </div>
      </div>
    </div>

    <button class="logout-btn" id="logoutBtn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
  </div>

  <!-- ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º -->
  <div class="test-mode-banner">
    <span class="banner-icon">ğŸ§ª</span>
    <strong>ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰:</strong> å®Ÿéš›ã®ãƒ¡ãƒ¼ãƒ«ã¯é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚Magic Linkãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ã‚’ä½“é¨“ã§ãã¾ã™ã€‚
  </div>
</div>
  `}
  css={`
.auth-container {
  max-width: 480px;
  margin: 0 auto;
  padding: 1rem;
}

/* ãƒ­ã‚´ */
.logo {
  font-size: 4rem;
  text-align: center;
  margin-bottom: 1.5rem;
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

/* ãƒ­ã‚°ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰ */
.login-card, .email-sent-card, .verifying-card, .success-card {
  background: linear-gradient(135deg, #1f2a37 0%, #374151 100%);
  border-radius: 16px;
  padding: 2.5rem 2rem;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
  border: 2px solid #374151;
  animation: slideUp 0.5s ease-out;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.title {
  font-size: 1.75rem;
  font-weight: 700;
  color: #e5edf4;
  text-align: center;
  margin: 0 0 0.75rem 0;
}

.subtitle {
  color: #9ca3af;
  text-align: center;
  margin: 0 0 2rem 0;
  font-size: 0.95rem;
  line-height: 1.5;
}

/* ãƒ•ã‚©ãƒ¼ãƒ  */
.login-form {
  margin-bottom: 1.5rem;
}

.form-group {
  margin-bottom: 1.5rem;
}

.label {
  display: block;
  color: #d1d5db;
  font-size: 0.875rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.input {
  width: 100%;
  background: #0c1218;
  border: 2px solid #374151;
  color: #e5edf4;
  padding: 0.875rem 1rem;
  border-radius: 8px;
  font-size: 1rem;
  transition: border-color 0.2s, box-shadow 0.2s;
  outline: none;
}

.input:focus {
  border-color: #60a5fa;
  box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
}

.input::placeholder {
  color: #6b7280;
}

/* é€ä¿¡ãƒœã‚¿ãƒ³ */
.submit-btn {
  width: 100%;
  background: linear-gradient(135deg, #60a5fa, #3b82f6);
  color: #ffffff;
  border: none;
  padding: 1rem;
  border-radius: 10px;
  font-size: 1.125rem;
  font-weight: 700;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(96, 165, 250, 0.3);
}

.submit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(96, 165, 250, 0.4);
}

.submit-btn:active {
  transform: translateY(0);
}

.submit-btn.loading {
  background: #4b5563;
  cursor: not-allowed;
}

.submit-btn.loading .btn-text::after {
  content: '...';
  animation: dots 1.5s infinite;
}

@keyframes dots {
  0%, 20% { content: '.'; }
  40% { content: '..'; }
  60%, 100% { content: '...'; }
}

/* ã‚¤ãƒ³ãƒ•ã‚©ãƒœãƒƒã‚¯ã‚¹ */
.info-box {
  background: #0c1218;
  border: 1px solid #374151;
  border-radius: 8px;
  padding: 1rem;
  display: flex;
  gap: 0.75rem;
  font-size: 0.875rem;
  color: #9ca3af;
  line-height: 1.5;
  margin-bottom: 1.5rem;
}

.info-icon {
  font-size: 1.25rem;
  flex-shrink: 0;
}

/* æ©Ÿèƒ½ãƒªã‚¹ãƒˆ */
.features {
  display: flex;
  justify-content: space-around;
  gap: 1rem;
  padding-top: 1.5rem;
  border-top: 1px solid #374151;
}

.feature-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  flex: 1;
}

.feature-icon {
  font-size: 1.75rem;
}

.feature-text {
  font-size: 0.75rem;
  color: #9ca3af;
  text-align: center;
}

/* ãƒ¡ãƒ¼ãƒ«é€ä¿¡å®Œäº†ç”»é¢ */
.checkmark-wrapper {
  display: flex;
  justify-content: center;
  margin-bottom: 1.5rem;
}

.checkmark {
  width: 80px;
  height: 80px;
  background: linear-gradient(135deg, #10b981, #059669);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 3rem;
  color: #ffffff;
  animation: scaleIn 0.5s ease-out;
}

@keyframes scaleIn {
  from {
    transform: scale(0);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

.success-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: #e5edf4;
  text-align: center;
  margin: 0 0 0.75rem 0;
}

.success-message {
  color: #9ca3af;
  text-align: center;
  margin: 0 0 2rem 0;
  line-height: 1.5;
}

.success-message strong {
  color: #60a5fa;
}

/* ãƒ¡ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
.email-preview {
  background: #0c1218;
  border: 1px solid #374151;
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 1.5rem;
}

.email-header {
  background: #1f2a37;
  padding: 1rem;
  border-bottom: 1px solid #374151;
  font-size: 0.875rem;
  color: #9ca3af;
}

.email-from, .email-subject {
  margin: 0.25rem 0;
}

.email-body {
  padding: 1.5rem;
  color: #d1d5db;
  font-size: 0.9rem;
  line-height: 1.6;
}

.email-body p {
  margin: 0.75rem 0;
}

.magic-link-btn {
  width: 100%;
  background: linear-gradient(135deg, #60a5fa, #3b82f6);
  color: #ffffff;
  border: none;
  padding: 0.875rem 1.5rem;
  border-radius: 8px;
  font-size: 1rem;
  font-weight: 700;
  cursor: pointer;
  margin: 1.25rem 0;
  transition: all 0.2s;
}

.magic-link-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(96, 165, 250, 0.4);
}

.email-note {
  font-size: 0.8rem;
  color: #6b7280;
  margin-top: 1rem !important;
  text-align: center;
}

/* æŒ‡ç¤º */
.instructions {
  text-align: center;
  padding: 1.25rem;
  background: #0c1218;
  border-radius: 8px;
  margin-bottom: 1.5rem;
}

.instructions p {
  margin: 0.5rem 0;
  color: #d1d5db;
}

.small-text {
  font-size: 0.8rem;
  color: #6b7280 !important;
}

/* æˆ»ã‚‹ãƒœã‚¿ãƒ³ */
.back-btn {
  width: 100%;
  background: #374151;
  color: #e5edf4;
  border: none;
  padding: 0.875rem;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.2s;
}

.back-btn:hover {
  background: #4b5563;
}

/* èªè¨¼ä¸­ç”»é¢ */
.spinner {
  width: 60px;
  height: 60px;
  border: 4px solid #374151;
  border-top-color: #60a5fa;
  border-radius: 50%;
  margin: 0 auto 1.5rem;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.verifying-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: #e5edf4;
  text-align: center;
  margin: 0 0 0.75rem 0;
}

.verifying-message {
  color: #9ca3af;
  text-align: center;
  margin: 0;
}

/* ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸç”»é¢ */
.welcome-icon {
  font-size: 4rem;
  text-align: center;
  margin-bottom: 1rem;
  animation: wave 1s ease-in-out;
}

@keyframes wave {
  0%, 100% { transform: rotate(0deg); }
  25% { transform: rotate(20deg); }
  75% { transform: rotate(-20deg); }
}

.welcome-title {
  font-size: 1.75rem;
  font-weight: 700;
  color: #e5edf4;
  text-align: center;
  margin: 0 0 0.75rem 0;
}

.welcome-message {
  color: #9ca3af;
  text-align: center;
  margin: 0 0 2rem 0;
}

.welcome-message strong {
  color: #60a5fa;
}

/* ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ */
.user-dashboard {
  background: #0c1218;
  border-radius: 10px;
  padding: 1.25rem;
  margin-bottom: 1.5rem;
}

.dashboard-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.875rem 0;
  border-bottom: 1px solid #1f2a37;
}

.dashboard-item:last-child {
  border-bottom: none;
}

.dashboard-icon {
  font-size: 1.75rem;
  width: 45px;
  text-align: center;
}

.dashboard-content {
  flex: 1;
}

.dashboard-label {
  font-size: 0.75rem;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 0.25rem;
}

.dashboard-value {
  font-size: 0.95rem;
  color: #e5edf4;
  font-weight: 600;
}

/* ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ */
.logout-btn {
  width: 100%;
  background: #374151;
  color: #e5edf4;
  border: none;
  padding: 0.875rem;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.2s;
}

.logout-btn:hover {
  background: #4b5563;
}

/* ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ãƒãƒŠãƒ¼ */
.test-mode-banner {
  background: linear-gradient(135deg, #1f2a37, #374151);
  border: 2px solid #f59e0b;
  border-radius: 12px;
  padding: 1rem;
  margin-top: 1.5rem;
  font-size: 0.875rem;
  color: #d1d5db;
  line-height: 1.6;
}

.banner-icon {
  font-size: 1.25rem;
  margin-right: 0.5rem;
}

@media (max-width: 480px) {
  .login-card, .email-sent-card, .verifying-card, .success-card {
    padding: 2rem 1.5rem;
  }

  .features {
    flex-direction: column;
  }
}
  `}
  js={`
// çŠ¶æ…‹ç®¡ç†
let currentEmail = '';
let currentToken = '';

// è¦ç´ ã®å–å¾—
const loginCard = document.getElementById('loginCard');
const emailSentCard = document.getElementById('emailSentCard');
const verifyingCard = document.getElementById('verifyingCard');
const successCard = document.getElementById('successCard');

const loginForm = document.getElementById('loginForm');
const emailInput = document.getElementById('email');
const submitBtn = document.getElementById('submitBtn');
const backBtn = document.getElementById('backBtn');
const magicLinkBtn = document.getElementById('magicLinkBtn');
const logoutBtn = document.getElementById('logoutBtn');

// ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
loginForm.addEventListener('submit', async (e) => {
  e.preventDefault();

  const email = emailInput.value.trim();
  if (!email) return;

  currentEmail = email;

  // ãƒœã‚¿ãƒ³ã‚’ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã«
  submitBtn.classList.add('loading');
  submitBtn.querySelector('.btn-text').textContent = 'ãƒ¡ãƒ¼ãƒ«é€ä¿¡ä¸­';

  // APIã‚³ãƒ¼ãƒ«ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼‰
  await sendMagicLink(email);

  submitBtn.classList.remove('loading');
  submitBtn.querySelector('.btn-text').textContent = 'Magic Linkã‚’é€ä¿¡';

  // ãƒ¡ãƒ¼ãƒ«é€ä¿¡å®Œäº†ç”»é¢ã‚’è¡¨ç¤º
  showEmailSent(email);
});

// Magic Linké€ä¿¡ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
async function sendMagicLink(email) {
  // å®Ÿéš›ã«ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã‚’å‘¼ã³å‡ºã™
  await new Promise(resolve => setTimeout(resolve, 1500));

  // ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼‰
  currentToken = generateToken();

  console.log('Magic Link sent to:', email);
  console.log('Token:', currentToken);
}

// ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰
function generateToken() {
  return 'demo_token_' + Math.random().toString(36).substring(2, 15);
}

// ãƒ¡ãƒ¼ãƒ«é€ä¿¡å®Œäº†ç”»é¢è¡¨ç¤º
function showEmailSent(email) {
  document.getElementById('sentEmail').textContent = email;

  loginCard.style.display = 'none';
  emailSentCard.style.display = 'block';
}

// Magic Linkã‚¯ãƒªãƒƒã‚¯
magicLinkBtn.addEventListener('click', async () => {
  // èªè¨¼ä¸­ç”»é¢ã‚’è¡¨ç¤º
  emailSentCard.style.display = 'none';
  verifyingCard.style.display = 'block';

  // ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼‰
  await verifyToken(currentToken);

  // ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸç”»é¢ã‚’è¡¨ç¤º
  showSuccess(currentEmail);
});

// ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
async function verifyToken(token) {
  // å®Ÿéš›ã«ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã‚’å‘¼ã³å‡ºã™
  await new Promise(resolve => setTimeout(resolve, 2000));

  console.log('Token verified:', token);

  // ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­å®šï¼ˆå®Ÿéš›ã«ã¯JWTãªã©ã‚’ä¿å­˜ï¼‰
  sessionStorage.setItem('authToken', token);
  sessionStorage.setItem('userEmail', currentEmail);
}

// ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸç”»é¢è¡¨ç¤º
function showSuccess(email) {
  document.getElementById('loggedInEmail').textContent = email;

  // ç¾åœ¨æ™‚åˆ»ã‚’è¡¨ç¤º
  const now = new Date();
  document.getElementById('loginTime').textContent = now.toLocaleString('ja-JP');

  verifyingCard.style.display = 'none';
  successCard.style.display = 'block';
}

// æˆ»ã‚‹ãƒœã‚¿ãƒ³
backBtn.addEventListener('click', () => {
  emailSentCard.style.display = 'none';
  loginCard.style.display = 'block';
  emailInput.value = '';
});

// ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³
logoutBtn.addEventListener('click', () => {
  // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¯ãƒªã‚¢
  sessionStorage.removeItem('authToken');
  sessionStorage.removeItem('userEmail');

  // ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹
  successCard.style.display = 'none';
  loginCard.style.display = 'block';
  emailInput.value = '';
  currentEmail = '';
  currentToken = '';
});

// åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºèª
window.addEventListener('load', () => {
  const savedToken = sessionStorage.getItem('authToken');
  const savedEmail = sessionStorage.getItem('userEmail');

  if (savedToken && savedEmail) {
    currentEmail = savedEmail;
    currentToken = savedToken;
    showSuccess(savedEmail);
  }
});
  `}
/>

## å‰ææ¡ä»¶

### å¿…è¦ãªã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ»è¨­å®š

1. **ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚µãƒ¼ãƒ“ã‚¹**
   - [Resend](https://resend.com/) - ãŠã™ã™ã‚ï¼ˆç„¡æ–™æ ã‚ã‚Šï¼‰
   - [SendGrid](https://sendgrid.com/) - å¤§è¦æ¨¡å‘ã‘
   - [AWS SES](https://aws.amazon.com/ses/) - AWSãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘

2. **APIã‚­ãƒ¼ã®å–å¾—**
   - Resend: Dashboard â†’ API Keys â†’ Create API Key
   - SendGrid: Settings â†’ API Keys â†’ Create API Key

3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆæ¨å¥¨ï¼‰**
   - PostgreSQL, MySQL, MongoDB ãªã©
   - ãƒˆãƒ¼ã‚¯ãƒ³ã®ä¿å­˜ã¨æ¤œè¨¼ã«ä½¿ç”¨

## ç’°å¢ƒè¨­å®š

### .env.example

```bash
# JWT Secretï¼ˆãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡å­—åˆ—ã‚’ç”Ÿæˆï¼‰
JWT_SECRET=your_super_secret_key_here_min_32_characters

# ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆResendã¾ãŸã¯SendGridï¼‰
EMAIL_API_KEY=re_xxxxxxxxxxxxxxxxxxxxxxxxxx
EMAIL_FROM=noreply@yourdomain.com

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³URL
APP_URL=http://localhost:3000

# Magic Linkè¨­å®š
MAGIC_LINK_TTL=900  # ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ï¼ˆç§’ï¼‰: 15åˆ† = 900ç§’
MAGIC_LINK_LENGTH=32  # ãƒˆãƒ¼ã‚¯ãƒ³ã®é•·ã•

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
DATABASE_URL=postgresql://user:password@localhost:5432/dbname

# ãƒ¬ãƒ¼ãƒˆåˆ¶é™
RATE_LIMIT_MAX=5  # 1æ™‚é–“ã‚ãŸã‚Šã®æœ€å¤§ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°
RATE_LIMIT_WINDOW=3600  # ç§’å˜ä½ï¼ˆ1æ™‚é–“ = 3600ç§’ï¼‰
```

### ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# å¿…é ˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
npm install jsonwebtoken bcryptjs

# ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼ˆã„ãšã‚Œã‹é¸æŠï¼‰
npm install resend  # ãŠã™ã™ã‚
# ã¾ãŸã¯
npm install @sendgrid/mail

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆä½¿ç”¨ã™ã‚‹DBã«å¿œã˜ã¦ï¼‰
npm install pg  # PostgreSQL
npm install mysql2  # MySQL
npm install mongoose  # MongoDB

# Express.jsç”¨ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
npm install express-rate-limit
npm install cors
```

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

### 1. ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```jsx
// components/MagicLinkLogin.jsx
import { useState } from 'react';

export default function MagicLinkLogin() {
  const [email, setEmail] = useState('');
  const [loading, setLoading] = useState(false);
  const [sent, setSent] = useState(false);
  const [error, setError] = useState('');

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError('');

    try {
      const response = await fetch('/api/auth/send-magic-link', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ email }),
      });

      if (!response.ok) {
        const data = await response.json();
        throw new Error(data.error || 'Failed to send magic link');
      }

      setSent(true);
    } catch (err) {
      setError(err.message);
    } finally {
      setLoading(false);
    }
  };

  if (sent) {
    return (
      <div style={{ textAlign: 'center', padding: '2rem' }}>
        <div style={{ fontSize: '4rem', marginBottom: '1rem' }}>âœ‰ï¸</div>
        <h2>ãƒ¡ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„</h2>
        <p>
          <strong>{email}</strong> ã«Magic Linkã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚
        </p>
        <p style={{ color: '#6b7280', fontSize: '0.875rem' }}>
          ãƒªãƒ³ã‚¯ã®æœ‰åŠ¹æœŸé™ã¯15åˆ†é–“ã§ã™ã€‚
        </p>
        <button
          onClick={() => {
            setSent(false);
            setEmail('');
          }}
          style={{
            marginTop: '1rem',
            padding: '0.75rem 1.5rem',
            background: '#374151',
            color: '#e5edf4',
            border: 'none',
            borderRadius: '8px',
            cursor: 'pointer',
          }}
        >
          åˆ¥ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è©¦ã™
        </button>
      </div>
    );
  }

  return (
    <form onSubmit={handleSubmit} style={{ maxWidth: '400px', margin: '2rem auto' }}>
      <h1 style={{ textAlign: 'center', marginBottom: '1rem' }}>
        Magic Linkã§ãƒ­ã‚°ã‚¤ãƒ³
      </h1>

      <div style={{ marginBottom: '1rem' }}>
        <label
          htmlFor="email"
          style={{
            display: 'block',
            marginBottom: '0.5rem',
            fontWeight: '600',
            fontSize: '0.875rem',
          }}
        >
          ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
        </label>
        <input
          type="email"
          id="email"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          placeholder="your@email.com"
          required
          style={{
            width: '100%',
            padding: '0.875rem',
            background: '#0c1218',
            border: '2px solid #374151',
            borderRadius: '8px',
            color: '#e5edf4',
            fontSize: '1rem',
          }}
        />
      </div>

      {error && (
        <p style={{ color: '#ef4444', fontSize: '0.875rem', marginBottom: '1rem' }}>
          {error}
        </p>
      )}

      <button
        type="submit"
        disabled={loading}
        style={{
          width: '100%',
          padding: '1rem',
          background: loading ? '#4b5563' : '#60a5fa',
          color: '#ffffff',
          border: 'none',
          borderRadius: '8px',
          fontSize: '1rem',
          fontWeight: 'bold',
          cursor: loading ? 'not-allowed' : 'pointer',
        }}
      >
        {loading ? 'é€ä¿¡ä¸­...' : 'Magic Linkã‚’é€ä¿¡'}
      </button>

      <p style={{ textAlign: 'center', marginTop: '1rem', fontSize: '0.875rem', color: '#6b7280' }}>
        ğŸ”’ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸è¦ã§å®‰å…¨ã«ãƒ­ã‚°ã‚¤ãƒ³ã§ãã¾ã™
      </p>
    </form>
  );
}
```

### 2. Magic Linkæ¤œè¨¼ãƒšãƒ¼ã‚¸

```jsx
// pages/auth/verify.jsx
import { useEffect, useState } from 'react';
import { useRouter } from 'next/router';

export default function VerifyMagicLink() {
  const router = useRouter();
  const { token } = router.query;
  const [status, setStatus] = useState('verifying'); // verifying | success | error
  const [error, setError] = useState('');

  useEffect(() => {
    if (token) {
      verifyToken(token);
    }
  }, [token]);

  const verifyToken = async (token) => {
    try {
      const response = await fetch('/api/auth/verify-magic-link', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ token }),
      });

      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.error || 'Verification failed');
      }

      // JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜
      localStorage.setItem('authToken', data.token);

      setStatus('success');

      // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      setTimeout(() => {
        router.push('/dashboard');
      }, 2000);
    } catch (err) {
      setError(err.message);
      setStatus('error');
    }
  };

  if (status === 'verifying') {
    return (
      <div style={{ textAlign: 'center', padding: '4rem 2rem' }}>
        <div style={{
          width: '60px',
          height: '60px',
          border: '4px solid #374151',
          borderTopColor: '#60a5fa',
          borderRadius: '50%',
          margin: '0 auto 1.5rem',
          animation: 'spin 1s linear infinite',
        }}></div>
        <h2>èªè¨¼ä¸­...</h2>
        <p style={{ color: '#6b7280' }}>å°‘ã€…ãŠå¾…ã¡ãã ã•ã„</p>
      </div>
    );
  }

  if (status === 'success') {
    return (
      <div style={{ textAlign: 'center', padding: '4rem 2rem' }}>
        <div style={{ fontSize: '4rem', marginBottom: '1rem' }}>âœ“</div>
        <h2>ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼</h2>
        <p style={{ color: '#6b7280' }}>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¦ã„ã¾ã™...</p>
      </div>
    );
  }

  return (
    <div style={{ textAlign: 'center', padding: '4rem 2rem' }}>
      <div style={{ fontSize: '4rem', marginBottom: '1rem', color: '#ef4444' }}>âœ•</div>
      <h2>èªè¨¼å¤±æ•—</h2>
      <p style={{ color: '#ef4444' }}>{error}</p>
      <p style={{ color: '#6b7280', marginTop: '1rem' }}>
        ãƒªãƒ³ã‚¯ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã‚‹ã‹ã€æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚
      </p>
      <button
        onClick={() => router.push('/login')}
        style={{
          marginTop: '2rem',
          padding: '0.75rem 2rem',
          background: '#60a5fa',
          color: '#ffffff',
          border: 'none',
          borderRadius: '8px',
          cursor: 'pointer',
        }}
      >
        ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹
      </button>
    </div>
  );
}
```

## ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…

### 1. ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆã¨ãƒ¡ãƒ¼ãƒ«é€ä¿¡API

```javascript
// pages/api/auth/send-magic-link.js
import crypto from 'crypto';
import jwt from 'jsonwebtoken';
import { Resend } from 'resend';

const resend = new Resend(process.env.EMAIL_API_KEY);

// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆç°¡æ˜“ç‰ˆ - å®Ÿéš›ã«ã¯DBã‚’ä½¿ç”¨ï¼‰
const tokenStore = new Map();

export default async function handler(req, res) {
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Method not allowed' });
  }

  const { email } = req.body;

  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  if (!email || !isValidEmail(email)) {
    return res.status(400).json({ error: 'Invalid email address' });
  }

  // ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯ï¼ˆå®Ÿè£…ã¯å¾Œè¿°ï¼‰
  // if (await isRateLimited(email)) {
  //   return res.status(429).json({ error: 'Too many requests' });
  // }

  try {
    // ã‚»ã‚­ãƒ¥ã‚¢ãªãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
    const token = crypto.randomBytes(32).toString('hex');

    // ãƒˆãƒ¼ã‚¯ãƒ³æƒ…å ±ã‚’ä¿å­˜ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã™ã¹ãï¼‰
    const tokenData = {
      email,
      token,
      createdAt: Date.now(),
      expiresAt: Date.now() + parseInt(process.env.MAGIC_LINK_TTL) * 1000,
      used: false,
    };

    tokenStore.set(token, tokenData);

    // Magic Linkã®ç”Ÿæˆ
    const magicLink = \`\${process.env.APP_URL}/auth/verify?token=\${token}\`;

    // ãƒ¡ãƒ¼ãƒ«é€ä¿¡
    await resend.emails.send({
      from: process.env.EMAIL_FROM,
      to: email,
      subject: 'ãƒ­ã‚°ã‚¤ãƒ³ãƒªãƒ³ã‚¯',
      html: generateEmailHTML(magicLink, email),
    });

    res.status(200).json({ success: true });
  } catch (error) {
    console.error('Magic link error:', error);
    res.status(500).json({ error: 'Failed to send magic link' });
  }
}

// ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹æ¤œè¨¼
function isValidEmail(email) {
  const regex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;
  return regex.test(email);
}

// HTMLãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
function generateEmailHTML(magicLink, email) {
  return \`
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ­ã‚°ã‚¤ãƒ³ãƒªãƒ³ã‚¯</title>
</head>
<body style="margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: #0c1218;">
  <div style="max-width: 600px; margin: 0 auto; padding: 40px 20px;">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div style="text-align: center; margin-bottom: 40px;">
      <div style="font-size: 48px; margin-bottom: 16px;">ğŸ”</div>
      <h1 style="color: #e5edf4; font-size: 24px; margin: 0;">Magic Linkã§ãƒ­ã‚°ã‚¤ãƒ³</h1>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div style="background: linear-gradient(135deg, #1f2a37 0%, #374151 100%); border-radius: 16px; padding: 32px; border: 2px solid #374151;">
      <p style="color: #d1d5db; margin: 0 0 24px 0; font-size: 16px; line-height: 1.6;">
        ã“ã‚“ã«ã¡ã¯ï¼
      </p>

      <p style="color: #d1d5db; margin: 0 0 24px 0; font-size: 16px; line-height: 1.6;">
        ä»¥ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€<strong style="color: #60a5fa;">\${email}</strong> ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚
      </p>

      <!-- ãƒœã‚¿ãƒ³ -->
      <div style="text-align: center; margin: 32px 0;">
        <a href="\${magicLink}" style="display: inline-block; background: linear-gradient(135deg, #60a5fa, #3b82f6); color: #ffffff; text-decoration: none; padding: 16px 32px; border-radius: 10px; font-weight: 700; font-size: 18px; box-shadow: 0 4px 12px rgba(96, 165, 250, 0.3);">
          ğŸ” ãƒ­ã‚°ã‚¤ãƒ³
        </a>
      </div>

      <p style="color: #9ca3af; margin: 24px 0 0 0; font-size: 14px; text-align: center; line-height: 1.5;">
        ã“ã®ãƒªãƒ³ã‚¯ã¯<strong>15åˆ†é–“</strong>æœ‰åŠ¹ã§ã™ã€‚<br>
        ä¸€åº¦ä½¿ç”¨ã™ã‚‹ã¨ç„¡åŠ¹ã«ãªã‚Šã¾ã™ã€‚
      </p>
    </div>

    <!-- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æƒ…å ± -->
    <div style="background: #0c1218; border: 1px solid #374151; border-radius: 12px; padding: 20px; margin-top: 24px;">
      <p style="color: #9ca3af; margin: 0; font-size: 14px; line-height: 1.6;">
        <strong style="color: #f59e0b;">âš ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã™ã‚‹æ³¨æ„:</strong><br>
        ã“ã®ãƒ¡ãƒ¼ãƒ«ã«å¿ƒå½“ãŸã‚ŠãŒãªã„å ´åˆã¯ã€ç„¡è¦–ã—ã¦ãã ã•ã„ã€‚<br>
        ãƒ­ã‚°ã‚¤ãƒ³ãƒªãƒ³ã‚¯ã¯èª°ã«ã‚‚å…±æœ‰ã—ãªã„ã§ãã ã•ã„ã€‚
      </p>
    </div>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <div style="text-align: center; margin-top: 32px; padding-top: 24px; border-top: 1px solid #374151;">
      <p style="color: #6b7280; margin: 0; font-size: 12px;">
        ã“ã®ãƒ¡ãƒ¼ãƒ«ã¯è‡ªå‹•é€ä¿¡ã•ã‚Œã¦ã„ã¾ã™ã€‚<br>
        Â© 2025 YourApp. All rights reserved.
      </p>
    </div>
  </div>
</body>
</html>
  \`;
}
```

### 2. ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼API

```javascript
// pages/api/auth/verify-magic-link.js
import jwt from 'jsonwebtoken';

// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆç°¡æ˜“ç‰ˆ - å®Ÿéš›ã«ã¯DBã‚’ä½¿ç”¨ï¼‰
// æ³¨: å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯DBã«ä¿å­˜ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼
const tokenStore = new Map();

export default async function handler(req, res) {
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Method not allowed' });
  }

  const { token } = req.body;

  if (!token) {
    return res.status(400).json({ error: 'Token is required' });
  }

  try {
    // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
    const tokenData = tokenStore.get(token);

    if (!tokenData) {
      return res.status(401).json({ error: 'Invalid token' });
    }

    // ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚¯
    if (Date.now() > tokenData.expiresAt) {
      tokenStore.delete(token);
      return res.status(401).json({ error: 'Token expired' });
    }

    // ãƒ¯ãƒ³ã‚¿ã‚¤ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ãƒã‚§ãƒƒã‚¯ï¼ˆæ—¢ã«ä½¿ç”¨æ¸ˆã¿ã‹ï¼‰
    if (tokenData.used) {
      return res.status(401).json({ error: 'Token already used' });
    }

    // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨æ¸ˆã¿ã«ãƒãƒ¼ã‚¯
    tokenData.used = true;
    tokenStore.set(token, tokenData);

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ï¼ˆDBã‹ã‚‰ï¼‰
    // const user = await db.users.findOne({ email: tokenData.email });
    // if (!user) {
    //   // æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å ´åˆã¯ä½œæˆ
    //   user = await db.users.create({ email: tokenData.email });
    // }

    // JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆ
    const jwtToken = jwt.sign(
      {
        email: tokenData.email,
        userId: 'user_1234567890', // å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
        iat: Math.floor(Date.now() / 1000),
      },
      process.env.JWT_SECRET,
      {
        expiresIn: '7d', // 7æ—¥é–“æœ‰åŠ¹
      }
    );

    // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆä½¿ç”¨æ¸ˆã¿ãªã®ã§å‰Šé™¤ï¼‰
    setTimeout(() => {
      tokenStore.delete(token);
    }, 1000);

    res.status(200).json({
      success: true,
      token: jwtToken,
      user: {
        email: tokenData.email,
        userId: 'user_1234567890',
      },
    });
  } catch (error) {
    console.error('Token verification error:', error);
    res.status(500).json({ error: 'Verification failed' });
  }
}
```

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒï¼ˆPostgreSQLä¾‹ï¼‰

```sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  last_login TIMESTAMP
);

-- Magic Linkãƒˆãƒ¼ã‚¯ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE magic_link_tokens (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
  token VARCHAR(64) UNIQUE NOT NULL,
  email VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  expires_at TIMESTAMP NOT NULL,
  used BOOLEAN DEFAULT FALSE,
  used_at TIMESTAMP,
  ip_address VARCHAR(45),
  user_agent TEXT
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_token ON magic_link_tokens(token);
CREATE INDEX idx_email ON magic_link_tokens(email);
CREATE INDEX idx_expires_at ON magic_link_tokens(expires_at);

-- æœŸé™åˆ‡ã‚Œãƒˆãƒ¼ã‚¯ãƒ³ã®è‡ªå‹•å‰Šé™¤ï¼ˆPostgreSQLã®å ´åˆï¼‰
CREATE OR REPLACE FUNCTION delete_expired_tokens()
RETURNS void AS $$
BEGIN
  DELETE FROM magic_link_tokens
  WHERE expires_at < NOW() - INTERVAL '1 day';
END;
$$ LANGUAGE plpgsql;
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

### 1. ãƒˆãƒ¼ã‚¯ãƒ³ã®ç”Ÿæˆ

```javascript
// âœ… ã‚»ã‚­ãƒ¥ã‚¢ãªæ–¹æ³•
const crypto = require('crypto');

function generateSecureToken() {
  return crypto.randomBytes(32).toString('hex'); // 64æ–‡å­—ã®ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—
}

// âŒ æ¨å¥¨ã—ãªã„æ–¹æ³•
function insecureToken() {
  return Math.random().toString(36); // äºˆæ¸¬å¯èƒ½
}
```

### 2. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å®Ÿè£…

```javascript
// middleware/rateLimit.js
import rateLimit from 'express-rate-limit';

export const magicLinkLimiter = rateLimit({
  windowMs: parseInt(process.env.RATE_LIMIT_WINDOW) * 1000, // 1æ™‚é–“
  max: parseInt(process.env.RATE_LIMIT_MAX), // 5å›ã¾ã§
  message: 'ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå¤šã™ãã¾ã™ã€‚1æ™‚é–“å¾Œã«å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚',
  standardHeaders: true,
  legacyHeaders: false,
  keyGenerator: (req) => {
    // IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®çµ„ã¿åˆã‚ã›ã§ãƒ¬ãƒ¼ãƒˆåˆ¶é™
    return \`\${req.ip}:\${req.body.email}\`;
  },
});

// ä½¿ç”¨ä¾‹
// app.post('/api/auth/send-magic-link', magicLinkLimiter, handler);
```

### 3. CSRFä¿è­·

```javascript
// ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆæ™‚ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’å«ã‚ã‚‹
const csrfToken = crypto.randomBytes(32).toString('hex');

const tokenData = {
  email,
  token,
  csrfToken,
  sessionId: req.session.id,
  // ...
};

// æ¤œè¨¼æ™‚ã«CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯
if (tokenData.csrfToken !== req.body.csrfToken) {
  return res.status(403).json({ error: 'CSRF token mismatch' });
}
```

### 4. IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨User-Agentã®æ¤œè¨¼

```javascript
// ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆæ™‚ã«ä¿å­˜
const tokenData = {
  // ...
  ipAddress: req.ip,
  userAgent: req.headers['user-agent'],
};

// æ¤œè¨¼æ™‚ã«ãƒã‚§ãƒƒã‚¯ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
if (tokenData.ipAddress !== req.ip) {
  console.warn('IP address mismatch:', {
    original: tokenData.ipAddress,
    current: req.ip,
  });
  // è­¦å‘Šã®ã¿ï¼ˆãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„ - ãƒ¢ãƒã‚¤ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§IPãŒå¤‰ã‚ã‚‹å ´åˆãŒã‚ã‚‹ï¼‰
}
```

### 5. ãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒãƒƒã‚·ãƒ¥åŒ–

```javascript
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã¯ãƒãƒƒã‚·ãƒ¥åŒ–ã—ãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜
import bcrypt from 'bcryptjs';

async function storeToken(token, email) {
  const hashedToken = await bcrypt.hash(token, 10);

  await db.magicLinkTokens.create({
    token: hashedToken, // ãƒãƒƒã‚·ãƒ¥åŒ–
    email,
    expiresAt: new Date(Date.now() + 900000), // 15åˆ†
  });

  return token; // å¹³æ–‡ã®ãƒˆãƒ¼ã‚¯ãƒ³ã¯ãƒ¡ãƒ¼ãƒ«ã§é€ä¿¡
}

// æ¤œè¨¼æ™‚
async function verifyToken(token) {
  const tokens = await db.magicLinkTokens.findAll({
    where: {
      expiresAt: { $gt: new Date() },
      used: false,
    },
  });

  for (const storedToken of tokens) {
    const isValid = await bcrypt.compare(token, storedToken.token);
    if (isValid) {
      return storedToken;
    }
  }

  return null;
}
```

## ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç‰ˆï¼ˆHTMLãƒ¡ãƒ¼ãƒ«éå¯¾å¿œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨ï¼‰

```javascript
function generatePlainTextEmail(magicLink, email) {
  return \`
ã“ã‚“ã«ã¡ã¯ï¼

ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€\${email} ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚

\${magicLink}

ã“ã®ãƒªãƒ³ã‚¯ã¯15åˆ†é–“æœ‰åŠ¹ã§ã™ã€‚ä¸€åº¦ä½¿ç”¨ã™ã‚‹ã¨ç„¡åŠ¹ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ãƒ¡ãƒ¼ãƒ«ã«å¿ƒå½“ãŸã‚ŠãŒãªã„å ´åˆã¯ã€ç„¡è¦–ã—ã¦ãã ã•ã„ã€‚

---
Â© 2025 YourApp. All rights reserved.
  \`.trim();
}

// Resendã§ã®é€ä¿¡ä¾‹
await resend.emails.send({
  from: process.env.EMAIL_FROM,
  to: email,
  subject: 'ãƒ­ã‚°ã‚¤ãƒ³ãƒªãƒ³ã‚¯',
  html: generateEmailHTML(magicLink, email),
  text: generatePlainTextEmail(magicLink, email), // ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç‰ˆã‚‚è¿½åŠ 
});
```

## ãƒ†ã‚¹ãƒˆã‚¬ã‚¤ãƒ‰

### 1. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆJestï¼‰

```javascript
// __tests__/auth/magic-link.test.js
import { generateSecureToken, isValidEmail } from '../../lib/auth';

describe('Magic Link Authentication', () => {
  describe('generateSecureToken', () => {
    it('should generate a 64-character token', () => {
      const token = generateSecureToken();
      expect(token).toHaveLength(64);
    });

    it('should generate unique tokens', () => {
      const token1 = generateSecureToken();
      const token2 = generateSecureToken();
      expect(token1).not.toBe(token2);
    });
  });

  describe('isValidEmail', () => {
    it('should validate correct email addresses', () => {
      expect(isValidEmail('test@example.com')).toBe(true);
      expect(isValidEmail('user+tag@domain.co.jp')).toBe(true);
    });

    it('should reject invalid email addresses', () => {
      expect(isValidEmail('invalid')).toBe(false);
      expect(isValidEmail('@example.com')).toBe(false);
      expect(isValidEmail('test@')).toBe(false);
    });
  });
});
```

### 2. E2Eãƒ†ã‚¹ãƒˆï¼ˆPlaywrightï¼‰

```javascript
// e2e/magic-link.spec.js
import { test, expect } from '@playwright/test';

test('Magic Link login flow', async ({ page, context }) => {
  // ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹
  await page.goto('/login');

  // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›
  await page.fill('input[type="email"]', 'test@example.com');

  // Magic Linké€ä¿¡ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
  await page.click('button[type="submit"]');

  // ãƒ¡ãƒ¼ãƒ«é€ä¿¡å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
  await expect(page.locator('text=ãƒ¡ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„')).toBeVisible();

  // å®Ÿéš›ã®E2Eãƒ†ã‚¹ãƒˆã§ã¯ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ã®ãƒ¢ãƒƒã‚¯ãŒå¿…è¦
  // ã¾ãŸã¯ã€ãƒ†ã‚¹ãƒˆç”¨ã®ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—APIã‚’ç”¨æ„
});
```

## æœ¬ç•ªç’°å¢ƒãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- [ ] JWT_SECRETãŒå¼·åŠ›ãªãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ï¼ˆ32æ–‡å­—ä»¥ä¸Šï¼‰
- [ ] ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ãŒé©åˆ‡ï¼ˆ15åˆ†æ¨å¥¨ï¼‰
- [ ] ãƒ¯ãƒ³ã‚¿ã‚¤ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ï¼ˆ1æ™‚é–“5å›ãªã©ï¼‰
- [ ] HTTPSé€šä¿¡ãŒå¼·åˆ¶ã•ã‚Œã¦ã„ã‚‹
- [ ] CSRFå¯¾ç­–ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒˆãƒ¼ã‚¯ãƒ³ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒãƒƒã‚·ãƒ¥åŒ–ã—ã¦ä¿å­˜ã•ã‚Œã¦ã„ã‚‹

### ãƒ¡ãƒ¼ãƒ«é€ä¿¡

- [ ] é€ä¿¡å…ƒãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒ‰ãƒ¡ã‚¤ãƒ³èªè¨¼ï¼ˆSPF/DKIM/DMARCï¼‰
- [ ] ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚¨ãƒ©ãƒ¼ã®ãƒ­ã‚°è¨˜éŒ²
- [ ] ãƒ¡ãƒ¼ãƒ«é€ä¿¡å¤±æ•—æ™‚ã®ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½
- [ ] ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç‰ˆãƒ¡ãƒ¼ãƒ«ã®ç”¨æ„

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

- [ ] ãƒˆãƒ¼ã‚¯ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­å®š
- [ ] æœŸé™åˆ‡ã‚Œãƒˆãƒ¼ã‚¯ãƒ³ã®è‡ªå‹•å‰Šé™¤å‡¦ç†
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®š

### ç›£è¦–

- [ ] ãƒ¡ãƒ¼ãƒ«é€ä¿¡æˆåŠŸç‡ã®ç›£è¦–
- [ ] ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ã®æˆåŠŸ/å¤±æ•—ç‡ã®ç›£è¦–
- [ ] ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®ç™ºå‹•çŠ¶æ³ã®ç›£è¦–
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®é›†ç´„ã¨é€šçŸ¥

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“

- [ ] ãƒ¡ãƒ¼ãƒ«ãŒå±Šã‹ãªã„å ´åˆã®ãƒ˜ãƒ«ãƒ—ãƒšãƒ¼ã‚¸
- [ ] å†é€ä¿¡æ©Ÿèƒ½ï¼ˆã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ä»˜ãï¼‰
- [ ] ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ã®ã‚ã‹ã‚Šã‚„ã™ã„è¡¨ç¤º

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ¡ãƒ¼ãƒ«ãŒå±Šã‹ãªã„

1. **è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«ãƒ•ã‚©ãƒ«ãƒ€ã‚’ç¢ºèª**
2. **SPF/DKIMãƒ¬ã‚³ãƒ¼ãƒ‰ã®è¨­å®šç¢ºèª**
   ```bash
   # DNSãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèª
   dig TXT yourdomain.com
   dig TXT _dmarc.yourdomain.com
   ```
3. **ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ­ã‚°ã®ç¢ºèª**
   ```javascript
   console.log('Email sent:', {
     to: email,
     messageId: result.id,
     timestamp: new Date().toISOString(),
   });
   ```

### ãƒˆãƒ¼ã‚¯ãƒ³ãŒç„¡åŠ¹ã«ãªã‚‹

1. **æœ‰åŠ¹æœŸé™ã®ç¢ºèª**
   ```javascript
   console.log('Token expiry:', {
     createdAt: new Date(tokenData.createdAt),
     expiresAt: new Date(tokenData.expiresAt),
     now: new Date(),
   });
   ```
2. **ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®å•é¡Œ**
   - ã‚µãƒ¼ãƒãƒ¼ã¨DBã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’çµ±ä¸€
3. **ã‚¯ãƒ­ãƒƒã‚¯åŒæœŸ**
   ```bash
   # NTPã§æ™‚åˆ»åŒæœŸ
   sudo ntpdate -s time.nist.gov
   ```

### ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãŒå³ã—ã™ãã‚‹

```javascript
// é–‹ç™ºç’°å¢ƒã§ã¯ç·©å’Œ
const limiter = rateLimit({
  windowMs: process.env.NODE_ENV === 'production' ? 3600000 : 60000,
  max: process.env.NODE_ENV === 'production' ? 5 : 100,
});
```

## å¤–éƒ¨ãƒªãƒ³ã‚¯

- [Resend ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://resend.com/docs)
- [SendGrid API ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](https://docs.sendgrid.com/)
- [JWT.io - JWTãƒ‡ãƒãƒƒã‚¬ãƒ¼](https://jwt.io/)
- [OWASP Authentication Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html)
- [Node.js Crypto ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«](https://nodejs.org/api/crypto.html)
- [bcrypt.js ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://github.com/dcodeIO/bcrypt.js)

---

**æ³¨æ„:** ã“ã®ã‚³ãƒ¼ãƒ‰ä¾‹ã¯ãƒ†ã‚¹ãƒˆãƒ»å­¦ç¿’ç”¨ã§ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ä½¿ç”¨ã™ã‚‹å‰ã«ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å°‚é–€å®¶ã«ã‚ˆã‚‹ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å—ã‘ã¦ãã ã•ã„ã€‚
